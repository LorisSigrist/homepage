import{S as U,i as K,s as W,y as Z,a as C,k as P,e as B,z as Q,c as I,l as v,n as d,A as Y,b,M as J,g as X,d as tt,B as et,h as g,q as at,m as T,r as ot,G as lt,O as rt,u as nt,P as st}from"../chunks/index.9f3d506e.js";import{M as it}from"../chunks/Metadata.0ba2c02c.js";import{r as ut,l as ft,g as ct}from"../chunks/colorHex.af5767a3.js";function ht(){return{title:"Blurhash",author:"Loris Sigrist",description:"Description TBD, I don't know what it is yet."}}const xt=Object.freeze(Object.defineProperty({__proto__:null,load:ht},Symbol.toStringTag,{value:"Module"}));var F=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],k=e=>{let t=0;for(let o=0;o<e.length;o++){let a=e[o],n=F.indexOf(a);t=t*83+n}return t},$=(e,t)=>{var o="";for(let a=1;a<=t;a++){let n=Math.floor(e)/Math.pow(83,t-a)%83;o+=F[Math.floor(n)]}return o},_=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},y=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},pt=e=>e<0?-1:1,w=(e,t)=>pt(e)*Math.pow(Math.abs(e),t),x=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},mt=e=>{if(!e||e.length<6)throw new x("The blurhash string must be at least 6 characters");let t=k(e[0]),o=Math.floor(t/9)+1,a=t%9+1;if(e.length!==4+2*a*o)throw new x(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*a*o}`)},Mt=e=>{let t=e>>16,o=e>>8&255,a=e&255;return[_(t),_(o),_(a)]},gt=(e,t)=>{let o=Math.floor(e/361),a=Math.floor(e/19)%19,n=e%19;return[w((o-9)/9,2)*t,w((a-9)/9,2)*t,w((n-9)/9,2)*t]},bt=(e,t,o,a)=>{mt(e),a=a|1;let n=k(e[0]),h=Math.floor(n/9)+1,p=n%9+1,m=(k(e[1])+1)/166,r=new Array(p*h);for(let i=0;i<r.length;i++)if(i===0){let s=k(e.substring(2,6));r[i]=Mt(s)}else{let s=k(e.substring(4+i*2,6+i*2));r[i]=gt(s,m*a)}let u=t*4,c=new Uint8ClampedArray(u*o);for(let i=0;i<o;i++)for(let s=0;s<t;s++){let f=0,l=0,M=0;for(let S=0;S<h;S++)for(let E=0;E<p;E++){let D=Math.cos(Math.PI*s*E/t)*Math.cos(Math.PI*i*S/o),N=r[E+S*p];f+=N[0]*D,l+=N[1]*D,M+=N[2]*D}let A=y(f),q=y(l),G=y(M);c[4*s+0+i*u]=A,c[4*s+1+i*u]=q,c[4*s+2+i*u]=G,c[4*s+3+i*u]=255}return c},V=bt,L=4,dt=(e,t,o,a)=>{let n=0,h=0,p=0,m=t*L;for(let u=0;u<t;u++){let c=L*u;for(let i=0;i<o;i++){let s=c+i*m,f=a(u,i);n+=f*_(e[s]),h+=f*_(e[s+1]),p+=f*_(e[s+2])}}let r=1/(t*o);return[n*r,h*r,p*r]},_t=e=>{let t=y(e[0]),o=y(e[1]),a=y(e[2]);return(t<<16)+(o<<8)+a},yt=(e,t)=>{let o=Math.floor(Math.max(0,Math.min(18,Math.floor(w(e[0]/t,.5)*9+9.5)))),a=Math.floor(Math.max(0,Math.min(18,Math.floor(w(e[1]/t,.5)*9+9.5)))),n=Math.floor(Math.max(0,Math.min(18,Math.floor(w(e[2]/t,.5)*9+9.5))));return o*19*19+a*19+n},wt=(e,t,o,a,n)=>{if(a<1||a>9||n<1||n>9)throw new x("BlurHash must have between 1 and 9 components");if(t*o*4!==e.length)throw new x("Width and height must match the pixels array");let h=[];for(let i=0;i<n;i++)for(let s=0;s<a;s++){let f=s==0&&i==0?1:2,l=dt(e,t,o,(M,A)=>f*Math.cos(Math.PI*s*M/t)*Math.cos(Math.PI*i*A/o));h.push(l)}let p=h[0],m=h.slice(1),r="",u=a-1+(n-1)*9;r+=$(u,1);let c;if(m.length>0){let i=Math.max(...m.map(f=>Math.max(...f))),s=Math.floor(Math.max(0,Math.min(82,Math.floor(i*166-.5))));c=(s+1)/166,r+=$(s,1)}else c=1,r+=$(0,1);return r+=$(_t(p),4),m.forEach(i=>{r+=$(yt(i,c),2)}),r},$t=wt;function Ct(e,t=8,o=8){const a=V(e,t,o,1),n=H(1/t)+" 100%",h="no-repeat",p=[],m=[];for(let c=0;c<t;c++){const i=[];for(let f=0;f<o;f++){const l=j(a,c,f,t);i.push(l)}m.push(`linear-gradient(${i.join(",")})`);const s=c==0?"0 0":`${H(c/(t-1))} 0`;p.push(s)}const u="0 0 0 20px "+j(a,0,0,t);return{backgroundImage:m.join(","),backgroundPosition:p.join(","),backgroundSize:n,backgroundRepeat:h,boxShadow:u,filter:"blur(20px)",clipPath:"inset(0)"}}function j(e,t,o,a){const h=a*4,p=o*h+t*4,m=e[p],r=e[p+1],u=e[p+2];return ut(m,r,u)}function H(e){const t=e*100;return t===Math.round(t)?t+"%":t.toFixed(1)+"%"}function O(e){let t="";for(const o in e){const a=It(o),n=e[o];t+=`${a}: ${n};`}return t}function It(e){return e.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase()}function R(e){let t,o,a,n,h,p,m;return{c(){t=P("p"),o=at(e[0]),a=C(),n=P("canvas"),this.h()},l(r){t=v(r,"P",{});var u=T(t);o=ot(u,e[0]),u.forEach(g),a=I(r),n=v(r,"CANVAS",{class:!0}),T(n).forEach(g),this.h()},h(){d(n,"class","w-96")},m(r,u){b(r,t,u),lt(t,o),b(r,a,u),b(r,n,u),p||(m=rt(h=e[3].call(null,n,e[0])),p=!0)},p(r,u){u&1&&nt(o,r[0]),h&&st(h.update)&&u&1&&h.update.call(null,r[0])},d(r){r&&g(t),r&&g(a),r&&g(n),p=!1,m()}}}function z(e){let t,o;return{c(){t=P("div"),this.h()},l(a){t=v(a,"DIV",{class:!0,style:!0}),T(t).forEach(g),this.h()},h(){d(t,"class","w-96 h-96"),d(t,"style",o=O(e[1]))},m(a,n){b(a,t,n)},p(a,n){n&2&&o!==(o=O(a[1]))&&d(t,"style",o)},d(a){a&&g(t)}}}function kt(e){let t,o,a,n,h,p,m,r,u,c,i;t=new it({});let s=e[0]&&R(e),f=e[1]&&z(e);return{c(){Z(t.$$.fragment),o=C(),a=P("input"),n=C(),s&&s.c(),h=C(),p=P("br"),m=C(),f&&f.c(),r=B(),this.h()},l(l){Q(t.$$.fragment,l),o=I(l),a=v(l,"INPUT",{type:!0,accept:!0}),n=I(l),s&&s.l(l),h=I(l),p=v(l,"BR",{}),m=I(l),f&&f.l(l),r=B(),this.h()},h(){d(a,"type","file"),d(a,"accept","image/*")},m(l,M){Y(t,l,M),b(l,o,M),b(l,a,M),b(l,n,M),s&&s.m(l,M),b(l,h,M),b(l,p,M),b(l,m,M),f&&f.m(l,M),b(l,r,M),u=!0,c||(i=J(a,"input",e[2]),c=!0)},p(l,[M]){l[0]?s?s.p(l,M):(s=R(l),s.c(),s.m(h.parentNode,h)):s&&(s.d(1),s=null),l[1]?f?f.p(l,M):(f=z(l),f.c(),f.m(r.parentNode,r)):f&&(f.d(1),f=null)},i(l){u||(X(t.$$.fragment,l),u=!0)},o(l){tt(t.$$.fragment,l),u=!1},d(l){et(t,l),l&&g(o),l&&g(a),l&&g(n),s&&s.d(l),l&&g(h),l&&g(p),l&&g(m),f&&f.d(l),l&&g(r),c=!1,i()}}}function Pt(e,t,o){let a,n="LIGa8p0h$gtQ}TN_E4aw0k-lE4R-";async function h(m){const r=m.target.files[0];if(!r)return;console.log("File dropped");const u=await ft(r),c=ct(u);o(0,n=$t(c.data,c.width,c.height,4,3)),console.log("Blurhash encoded")}function p(m,r){const u=m.getContext("2d"),c=32,i=32;m.width=c,m.height=i;const s=()=>{const f=V(r,c,i),l=u.createImageData(c,i);l.data.set(f),u.putImageData(l,0,0)};return s(),{update(f){r=f,s()}}}return e.$$.update=()=>{e.$$.dirty&1&&o(1,a=n?Ct(n):null)},[n,a,h,p]}class At extends U{constructor(t){super(),K(this,t,Pt,kt,W,{})}}export{At as component,xt as universal};

var ut=Object.defineProperty;var ht=(w,d,p)=>d in w?ut(w,d,{enumerable:!0,configurable:!0,writable:!0,value:p}):w[d]=p;var b=(w,d,p)=>(ht(w,typeof d!="symbol"?d+"":d,p),p);(function(){"use strict";function w(e){if(e.length>4096)throw new Error("Too many colors - max 4096 colors");if(e.length<1)throw new Error("No colors provided");const t=new ImageData(64,64),r=new Uint8ClampedArray(e.length*4);for(let n=0;n<e.length;n++){const s=e[n];r.set(s,n<<2),r[n<<2|3]=255}for(let n=0;n<=4095;n++){const s=n>>6,i=n&63,o=n&15,l=n>>4&15,u=n>>8&15;let h=0,a=Number.MAX_SAFE_INTEGER;for(let c=0;c<e.length;c++){const g=((o<<4)-r[c<<2])**2+((l<<4)-r[c<<2|1])**2+((u<<4)-r[c<<2|2])**2;g<a&&(h=c,a=g)}const f=4*(i*t.width+s);t.data.set(r.slice(h<<2,(h<<2)+4),f)}return t}const d=8,p=5,O=1e3,A=p,m=d-p,j=.75;function T(e,t){return e<t?-1:e>t?1:0}class k{constructor(t){b(this,"contents",[]);b(this,"isSorted",!1);this.compareFn=t}sort(){this.isSorted||(this.contents.sort(this.compareFn),this.isSorted=!0)}push(t){this.contents.push(t),this.isSorted=!1}peek(t){return this.sort(),t===void 0&&(t=this.contents.length-1),this.contents[t]}pop(){return this.sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this.contents.map(t)}[Symbol.iterator](){return this.sort(),this.contents[Symbol.iterator]()}}class I{constructor(t,r,n,s,i,o,l){b(this,"_count");b(this,"_avg");this.r1=t,this.r2=r,this.g1=n,this.g2=s,this.b1=i,this.b2=o,this.histogram=l}volume(){return(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)}count(t=!1){if(this._count===void 0||t){let r=0;for(const[n,s,i]of this.colors())r+=this.histogram.sampleWithReducedColor(n,s,i);this._count=r}return this._count}copy(){return new I(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histogram)}avg(t=!1){if(!this._avg||t){let r=0;const n=1<<m;let s=0,i=0,o=0;for(const[l,u,h]of this.colors()){let a=this.histogram.sampleWithReducedColor(l,u,h);r+=a,s+=a*(l+.5)*n,i+=a*(u+.5)*n,o+=a*(h+.5)*n}r>0?this._avg=[Math.floor(s/r),Math.floor(i/r),Math.floor(o/r)]:this._avg=[Math.floor(n*(this.r1+this.r2+1)/2),Math.floor(n*(this.g1+this.g2+1)/2),Math.floor(n*(this.b1+this.b2+1)/2)]}return this._avg}contains(t){const r=t[0]>>m,n=t[1]>>m,s=t[2]>>m;return r>=this.r1&&r<=this.r2&&n>=this.g1&&n<=this.g2&&s>=this.b1&&s<=this.b2}*colors(){for(let t=this.r1;t<=this.r2;t++)for(let r=this.g1;r<=this.g2;r++)for(let n=this.b1;n<=this.b2;n++)yield[t,r,n]}}class B{constructor(){b(this,"boxes");this.boxes=new k((t,r)=>T(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume()))}push(t){this.boxes.push({vbox:t,color:t.avg()})}palette(){return this.boxes.map(t=>t.color)}size(){return this.boxes.size()}map(t){for(const r of this.boxes)if(r.vbox.contains(t))return r.color;return this.nearest(t)}nearest(t){let r,n,s;for(const i of this.boxes)n=Math.sqrt(Math.pow(t[0]-i.color[0],2)+Math.pow(t[1]-i.color[1],2)+Math.pow(t[2]-i.color[2],2)),(r===void 0||n<r)&&(r=n,s=i.color);return s}}class _{constructor(t){b(this,"histogram",new Array(1<<3*A));for(let r=0;r<t.length;r+=4){let n=t[r]>>m,s=t[r+1]>>m,i=t[r+2]>>m,o=_.getColorIndex(n,s,i);this.histogram[o]=(this.histogram[o]??0)+1}}sample(t,r,n){const s=t>>m,i=r>>m,o=n>>m;return this.sampleWithReducedColor(s,i,o)}sampleWithReducedColor(t,r,n){const s=_.getColorIndex(t,r,n);return this.histogram[s]??0}static getColorIndex(t,r,n){return(t<<2*A)+(r<<A)+n}}function G(e,t){let r=1e6,n=0,s=1e6,i=0,o=1e6,l=0;for(let u=0;u<e.length;u+=4){const h=e[u]>>m,a=e[u+1]>>m,f=e[u+2]>>m;h<r?r=h:h>n&&(n=h),a<s?s=a:a>i&&(i=a),f<o?o=f:f>l&&(l=f)}return new I(r,n,s,i,o,l,t)}function X(e,t,r,n,s){const i=s+"1",o=s+"2";for(let l=e[i];l<=e[o];l++)if(t[l]>n/2){let u=e.copy(),h=e.copy(),a=l-e[i],f=e[o]-l,c,g=0;for(a<=f?c=Math.min(e[o]-1,~~(l+f/2)):c=Math.max(e[i],~~(l-1-a/2));!t[c];)c++;for(g=r[c];!g&&t[c-1];)g=r[--c];return u[o]=c,h[i]=u[o]+1,[u,h]}throw new Error("VBox can't be cut")}function Y(e,t){if(!t.count())return[t.copy(),void 0];const r=t.r2-t.r1+1,n=t.g2-t.g1+1,s=t.b2-t.b1+1,i=Math.max(r,n,s);if(t.count()==1)return[t.copy(),void 0];let o=0;const l=[],u=[];if(i==r)for(let a=t.r1;a<=t.r2;a++){let f=0;for(let c=t.g1;c<=t.g2;c++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(a,c,g);o+=f,l[a]=o}else if(i==n)for(let a=t.g1;a<=t.g2;a++){let f=0;for(let c=t.r1;c<=t.r2;c++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(c,a,g);o+=f,l[a]=o}else if(i==s)for(let a=t.b1;a<=t.b2;a++){let f=0;for(let c=t.r1;c<=t.r2;c++)for(let g=t.g1;g<=t.g2;g++)f+=e.sampleWithReducedColor(c,g,a);o+=f,l[a]=o}else throw new Error("Not Reached");l.forEach(function(a,f){u[f]=o-a});const h=i==r?"r":i==n?"g":"b";return X(t,l,u,o,h)}function D(e,t){if(e.length<4||t<2||t>256)throw new Error("Invalid Arguments. There must be at least one pixel, and the max color must be between 2 and 256");const r=new _(e),n=G(e,r),s=new k((u,h)=>T(u.count(),h.count()));s.push(n);const i=(u,h)=>{let a=u.size(),f=0,c;for(;f<O;){if(a>=h||f++>O)return;if(c=u.pop(),!c||!c.count()){u.push(c),f++;continue}const[g,q]=Y(r,c);u.push(g),q&&(u.push(q),a++)}};i(s,j*t);const o=new k(function(u,h){return T(u.count()*u.volume(),h.count()*h.volume())});for(;s.size();)o.push(s.pop());i(o,t);const l=new B;for(;o.size();)l.push(o.pop());return l}function Q(e,t,r=10){const n=$(e.data,r),s=D(n,t);return s?s.palette():null}function $(e,t){const r=Math.floor(e.length/4),n=Math.max(1,Math.round(r/t)),s=new Uint8ClampedArray(n*4);for(let i=0;i<n;i++){const o=Math.round(i*r/n);s[i*4+0]=e[o*4+0],s[i*4+1]=e[o*4+1],s[i*4+2]=e[o*4+2],s[i*4+3]=e[o*4+3]}return s}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const W=Symbol("Comlink.proxy"),J=Symbol("Comlink.endpoint"),K=Symbol("Comlink.releaseProxy"),N=Symbol("Comlink.finalizer"),M=Symbol("Comlink.thrown"),x=e=>typeof e=="object"&&e!==null||typeof e=="function",Z={canHandle:e=>x(e)&&e[W],serialize(e){const{port1:t,port2:r}=new MessageChannel;return L(e,t),[r,[r]]},deserialize(e){return e.start(),nt(e)}},tt={canHandle:e=>x(e)&&M in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},v=new Map([["proxy",Z],["throw",tt]]);function et(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function L(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(s){if(!s||!s.data)return;if(!et(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:i,type:o,path:l}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(y);let h;try{const a=l.slice(0,-1).reduce((c,g)=>c[g],e),f=l.reduce((c,g)=>c[g],e);switch(o){case"GET":h=f;break;case"SET":a[l.slice(-1)[0]]=y(s.data.value),h=!0;break;case"APPLY":h=f.apply(a,u);break;case"CONSTRUCT":{const c=new f(...u);h=ct(c)}break;case"ENDPOINT":{const{port1:c,port2:g}=new MessageChannel;L(e,g),h=at(c,[c])}break;case"RELEASE":h=void 0;break;default:return}}catch(a){h={value:a,[M]:0}}Promise.resolve(h).catch(a=>({value:a,[M]:0})).then(a=>{const[f,c]=P(a);t.postMessage(Object.assign(Object.assign({},f),{id:i}),c),o==="RELEASE"&&(t.removeEventListener("message",n),F(t),N in e&&typeof e[N]=="function"&&e[N]())}).catch(a=>{const[f,c]=P({value:new TypeError("Unserializable return value"),[M]:0});t.postMessage(Object.assign(Object.assign({},f),{id:i}),c)})}),t.start&&t.start()}function rt(e){return e.constructor.name==="MessagePort"}function F(e){rt(e)&&e.close()}function nt(e,t){return z(e,[],t)}function S(e){if(e)throw new Error("Proxy has been released and is not useable")}function H(e){return E(e,{type:"RELEASE"}).then(()=>{F(e)})}const R=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(R.get(e)||0)-1;R.set(e,t),t===0&&H(e)});function st(e,t){const r=(R.get(t)||0)+1;R.set(t,r),C&&C.register(e,t,e)}function ot(e){C&&C.unregister(e)}function z(e,t=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(i,o){if(S(n),o===K)return()=>{ot(s),H(e),n=!0};if(o==="then"){if(t.length===0)return{then:()=>s};const l=E(e,{type:"GET",path:t.map(u=>u.toString())}).then(y);return l.then.bind(l)}return z(e,[...t,o])},set(i,o,l){S(n);const[u,h]=P(l);return E(e,{type:"SET",path:[...t,o].map(a=>a.toString()),value:u},h).then(y)},apply(i,o,l){S(n);const u=t[t.length-1];if(u===J)return E(e,{type:"ENDPOINT"}).then(y);if(u==="bind")return z(e,t.slice(0,-1));const[h,a]=U(l);return E(e,{type:"APPLY",path:t.map(f=>f.toString()),argumentList:h},a).then(y)},construct(i,o){S(n);const[l,u]=U(o);return E(e,{type:"CONSTRUCT",path:t.map(h=>h.toString()),argumentList:l},u).then(y)}});return st(s,e),s}function it(e){return Array.prototype.concat.apply([],e)}function U(e){const t=e.map(P);return[t.map(r=>r[0]),it(t.map(r=>r[1]))]}const V=new WeakMap;function at(e,t){return V.set(e,t),e}function ct(e){return Object.assign(e,{[W]:!0})}function P(e){for(const[t,r]of v)if(r.canHandle(e)){const[n,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},V.get(e)||[]]}function y(e){switch(e.type){case"HANDLER":return v.get(e.name).deserialize(e.value);case"RAW":return e.value}}function E(e,t,r){return new Promise(n=>{const s=lt();e.addEventListener("message",function i(o){!o.data||!o.data.id||o.data.id!==s||(e.removeEventListener("message",i),n(o.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),r)})}function lt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}L({generatePalette:w,getPalette:Q})})();

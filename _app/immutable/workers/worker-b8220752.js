var ht=Object.defineProperty;var ft=(y,d,w)=>d in y?ht(y,d,{enumerable:!0,configurable:!0,writable:!0,value:w}):y[d]=w;var E=(y,d,w)=>(ft(y,typeof d!="symbol"?d+"":d,w),w);(function(){"use strict";function y(e){if(e.length>4096)throw new Error("Too many colors - max 4096 colors");if(e.length<1)throw new Error("No colors provided");const t=new ImageData(64,64),r=new Uint8ClampedArray(e.length*4);for(let n=0;n<e.length;n++){const i=e[n];r.set(i,n<<2),r[n<<2|3]=255}const o=4095,s=15;for(let n=0;n<=o;n++){const i=n>>6,l=n&63,u=n&s,h=n>>4&s,a=n>>8&s;let f=0,c=Number.MAX_SAFE_INTEGER;for(let p=0;p<e.length;p++){const j=((u<<4)-r[p<<2])**2+((h<<4)-r[p<<2|1])**2+((a<<4)-r[p<<2|2])**2;j<c&&(f=p,c=j)}const g=(l<<6|i)<<2;t.data.set(r.slice(f<<2,(f<<2)+4),g)}return t}const d=8,w=5,W=1e3,T=w,m=d-w,B=.75;function k(e,t){return e<t?-1:e>t?1:0}class I{constructor(t){E(this,"contents",[]);E(this,"isSorted",!1);this.compareFn=t}sort(){this.isSorted||(this.contents.sort(this.compareFn),this.isSorted=!0)}push(t){this.contents.push(t),this.isSorted=!1}peek(t){return this.sort(),t===void 0&&(t=this.contents.length-1),this.contents[t]}pop(){return this.sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this.contents.map(t)}[Symbol.iterator](){return this.sort(),this.contents[Symbol.iterator]()}}class L{constructor(t,r,o,s,n,i,l){E(this,"_count");E(this,"_avg");this.r1=t,this.r2=r,this.g1=o,this.g2=s,this.b1=n,this.b2=i,this.histogram=l}volume(){return(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)}count(t=!1){if(this._count===void 0||t){let r=0;for(const[o,s,n]of this.colors())r+=this.histogram.sampleWithReducedColor(o,s,n);this._count=r}return this._count}copy(){return new L(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histogram)}avg(t=!1){if(!this._avg||t){let r=0;const o=1<<m;let s=0,n=0,i=0;for(const[l,u,h]of this.colors()){let a=this.histogram.sampleWithReducedColor(l,u,h);r+=a,s+=a*(l+.5)*o,n+=a*(u+.5)*o,i+=a*(h+.5)*o}r>0?this._avg=[Math.floor(s/r),Math.floor(n/r),Math.floor(i/r)]:this._avg=[Math.floor(o*(this.r1+this.r2+1)/2),Math.floor(o*(this.g1+this.g2+1)/2),Math.floor(o*(this.b1+this.b2+1)/2)]}return this._avg}contains(t){const r=t[0]>>m,o=t[1]>>m,s=t[2]>>m;return r>=this.r1&&r<=this.r2&&o>=this.g1&&o<=this.g2&&s>=this.b1&&s<=this.b2}*colors(){for(let t=this.r1;t<=this.r2;t++)for(let r=this.g1;r<=this.g2;r++)for(let o=this.b1;o<=this.b2;o++)yield[t,r,o]}}class G{constructor(){E(this,"boxes");this.boxes=new I((t,r)=>k(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume()))}push(t){this.boxes.push({vbox:t,color:t.avg()})}palette(){return this.boxes.map(t=>t.color)}size(){return this.boxes.size()}map(t){for(const r of this.boxes)if(r.vbox.contains(t))return r.color;return this.nearest(t)}nearest(t){let r,o,s;for(const n of this.boxes)o=Math.sqrt(Math.pow(t[0]-n.color[0],2)+Math.pow(t[1]-n.color[1],2)+Math.pow(t[2]-n.color[2],2)),(r===void 0||o<r)&&(r=o,s=n.color);return s}}class M{constructor(t){E(this,"histogram",new Array(1<<3*T));for(let r=0;r<t.length;r+=4){let o=t[r]>>m,s=t[r+1]>>m,n=t[r+2]>>m,i=M.getColorIndex(o,s,n);this.histogram[i]=(this.histogram[i]??0)+1}}sample(t,r,o){const s=t>>m,n=r>>m,i=o>>m;return this.sampleWithReducedColor(s,n,i)}sampleWithReducedColor(t,r,o){const s=M.getColorIndex(t,r,o);return this.histogram[s]??0}static getColorIndex(t,r,o){return(t<<2*T)+(r<<T)+o}}function X(e,t){let r=1e6,o=0,s=1e6,n=0,i=1e6,l=0;for(let u=0;u<e.length;u+=4){const h=e[u]>>m,a=e[u+1]>>m,f=e[u+2]>>m;h<r?r=h:h>o&&(o=h),a<s?s=a:a>n&&(n=a),f<i?i=f:f>l&&(l=f)}return new L(r,o,s,n,i,l,t)}function D(e,t,r,o,s){const n=s+"1",i=s+"2";for(let l=e[n];l<=e[i];l++)if(t[l]>o/2){let u=e.copy(),h=e.copy(),a=l-e[n],f=e[i]-l,c,g=0;for(a<=f?c=Math.min(e[i]-1,~~(l+f/2)):c=Math.max(e[n],~~(l-1-a/2));!t[c];)c++;for(g=r[c];!g&&t[c-1];)g=r[--c];return u[i]=c,h[n]=u[i]+1,[u,h]}throw new Error("VBox can't be cut")}function Y(e,t){if(!t.count())return[t.copy(),void 0];const r=t.r2-t.r1+1,o=t.g2-t.g1+1,s=t.b2-t.b1+1,n=Math.max(r,o,s);if(t.count()==1)return[t.copy(),void 0];let i=0;const l=[],u=[];if(n==r)for(let a=t.r1;a<=t.r2;a++){let f=0;for(let c=t.g1;c<=t.g2;c++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(a,c,g);i+=f,l[a]=i}else if(n==o)for(let a=t.g1;a<=t.g2;a++){let f=0;for(let c=t.r1;c<=t.r2;c++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(c,a,g);i+=f,l[a]=i}else if(n==s)for(let a=t.b1;a<=t.b2;a++){let f=0;for(let c=t.r1;c<=t.r2;c++)for(let g=t.g1;g<=t.g2;g++)f+=e.sampleWithReducedColor(c,g,a);i+=f,l[a]=i}else throw new Error("Not Reached");l.forEach(function(a,f){u[f]=i-a});const h=n==r?"r":n==o?"g":"b";return D(t,l,u,i,h)}function K(e,t){if(e.length<4||t<2||t>256)throw new Error("Invalid Arguments. There must be at least one pixel, and the max color must be between 2 and 256");const r=new M(e),o=X(e,r),s=new I((u,h)=>k(u.count(),h.count()));s.push(o);const n=(u,h)=>{let a=u.size(),f=0,c;for(;f<W;){if(a>=h||f++>W)return;if(c=u.pop(),!c||!c.count()){u.push(c),f++;continue}const[g,p]=Y(r,c);u.push(g),p&&(u.push(p),a++)}};n(s,B*t);const i=new I(function(u,h){return k(u.count()*u.volume(),h.count()*h.volume())});for(;s.size();)i.push(s.pop());n(i,t);const l=new G;for(;i.size();)l.push(i.pop());return l}function Q(e,t,r=10){const o=$(e.data,r),s=K(o,t);return s?s.palette():null}function $(e,t){const r=Math.floor(e.length/4),o=Math.max(1,Math.round(r/t)),s=new Uint8ClampedArray(o*4);for(let n=0;n<o;n++){const i=Math.round(n*r/o);s[n*4+0]=e[i*4+0],s[n*4+1]=e[i*4+1],s[n*4+2]=e[i*4+2],s[n*4+3]=e[i*4+3]}return s}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const x=Symbol("Comlink.proxy"),J=Symbol("Comlink.endpoint"),Z=Symbol("Comlink.releaseProxy"),N=Symbol("Comlink.finalizer"),S=Symbol("Comlink.thrown"),F=e=>typeof e=="object"&&e!==null||typeof e=="function",tt={canHandle:e=>F(e)&&e[x],serialize(e){const{port1:t,port2:r}=new MessageChannel;return z(e,t),[r,[r]]},deserialize(e){return e.start(),st(e)}},et={canHandle:e=>F(e)&&S in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},U=new Map([["proxy",tt],["throw",et]]);function rt(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function z(e,t=globalThis,r=["*"]){t.addEventListener("message",function o(s){if(!s||!s.data)return;if(!rt(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:n,type:i,path:l}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(b);let h;try{const a=l.slice(0,-1).reduce((c,g)=>c[g],e),f=l.reduce((c,g)=>c[g],e);switch(i){case"GET":h=f;break;case"SET":a[l.slice(-1)[0]]=b(s.data.value),h=!0;break;case"APPLY":h=f.apply(a,u);break;case"CONSTRUCT":{const c=new f(...u);h=lt(c)}break;case"ENDPOINT":{const{port1:c,port2:g}=new MessageChannel;z(e,g),h=ct(c,[c])}break;case"RELEASE":h=void 0;break;default:return}}catch(a){h={value:a,[S]:0}}Promise.resolve(h).catch(a=>({value:a,[S]:0})).then(a=>{const[f,c]=P(a);t.postMessage(Object.assign(Object.assign({},f),{id:n}),c),i==="RELEASE"&&(t.removeEventListener("message",o),v(t),N in e&&typeof e[N]=="function"&&e[N]())}).catch(a=>{const[f,c]=P({value:new TypeError("Unserializable return value"),[S]:0});t.postMessage(Object.assign(Object.assign({},f),{id:n}),c)})}),t.start&&t.start()}function nt(e){return e.constructor.name==="MessagePort"}function v(e){nt(e)&&e.close()}function st(e,t){return O(e,[],t)}function R(e){if(e)throw new Error("Proxy has been released and is not useable")}function H(e){return _(e,{type:"RELEASE"}).then(()=>{v(e)})}const A=new WeakMap,C="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(A.get(e)||0)-1;A.set(e,t),t===0&&H(e)});function ot(e,t){const r=(A.get(t)||0)+1;A.set(t,r),C&&C.register(e,t,e)}function it(e){C&&C.unregister(e)}function O(e,t=[],r=function(){}){let o=!1;const s=new Proxy(r,{get(n,i){if(R(o),i===Z)return()=>{it(s),H(e),o=!0};if(i==="then"){if(t.length===0)return{then:()=>s};const l=_(e,{type:"GET",path:t.map(u=>u.toString())}).then(b);return l.then.bind(l)}return O(e,[...t,i])},set(n,i,l){R(o);const[u,h]=P(l);return _(e,{type:"SET",path:[...t,i].map(a=>a.toString()),value:u},h).then(b)},apply(n,i,l){R(o);const u=t[t.length-1];if(u===J)return _(e,{type:"ENDPOINT"}).then(b);if(u==="bind")return O(e,t.slice(0,-1));const[h,a]=V(l);return _(e,{type:"APPLY",path:t.map(f=>f.toString()),argumentList:h},a).then(b)},construct(n,i){R(o);const[l,u]=V(i);return _(e,{type:"CONSTRUCT",path:t.map(h=>h.toString()),argumentList:l},u).then(b)}});return ot(s,e),s}function at(e){return Array.prototype.concat.apply([],e)}function V(e){const t=e.map(P);return[t.map(r=>r[0]),at(t.map(r=>r[1]))]}const q=new WeakMap;function ct(e,t){return q.set(e,t),e}function lt(e){return Object.assign(e,{[x]:!0})}function P(e){for(const[t,r]of U)if(r.canHandle(e)){const[o,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:o},s]}return[{type:"RAW",value:e},q.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return U.get(e.name).deserialize(e.value);case"RAW":return e.value}}function _(e,t,r){return new Promise(o=>{const s=ut();e.addEventListener("message",function n(i){!i.data||!i.data.id||i.data.id!==s||(e.removeEventListener("message",n),o(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),r)})}function ut(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}z({generatePalette:y,getPalette:Q})})();

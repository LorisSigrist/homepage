<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width" name=viewport> <link href=./_app/immutable/assets/Metadata.DyfCrczt.css rel=stylesheet> <link href=./_app/immutable/assets/3.CqjOwtjT.css rel=stylesheet> <link href=./_app/immutable/entry/start.wLMQjKKE.js rel=modulepreload> <link href=./_app/immutable/chunks/entry.Bt2s6KeL.js rel=modulepreload> <link href=./_app/immutable/chunks/scheduler.DwkGEAYb.js rel=modulepreload> <link href=./_app/immutable/chunks/index.CU0sutvA.js rel=modulepreload> <link href=./_app/immutable/entry/app.cPRhK7hZ.js rel=modulepreload> <link href=./_app/immutable/chunks/preload-helper.CP-VSAQc.js rel=modulepreload> <link href=./_app/immutable/chunks/index.BoYP9eQs.js rel=modulepreload> <link href=./_app/immutable/nodes/0.CMIPQFkk.js rel=modulepreload> <link href=./_app/immutable/nodes/2.BrjcYLc3.js rel=modulepreload> <link href=./_app/immutable/chunks/Metadata.BgZm5Bod.js rel=modulepreload> <link href=./_app/immutable/chunks/stores.DSksQIVc.js rel=modulepreload> <link href=./_app/immutable/chunks/each.CuygwpM4.js rel=modulepreload> <link href=./_app/immutable/chunks/theme.COyUI6g7.js rel=modulepreload> <link href=./_app/immutable/nodes/3.BMPqw2Om.js rel=modulepreload> <link href=./_app/immutable/nodes/7.7J3Dh_0O.js rel=modulepreload><title>Building an i18n library for the modern Web</title><!-- HEAD_svelte-1quh51c_START --><script data-svelte-h=svelte-ctkbxh>if("localStorage"in window){let e="dark"===localStorage.getItem("theme"),t="light"===localStorage.getItem("theme"),a=!e&&!t;if(e)document.documentElement.classList.add("dark");else if(t)document.documentElement.classList.remove("dark");else if(a){let e=window.matchMedia("(prefers-color-scheme: dark)");e.matches?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))}}</script><!-- HEAD_svelte-1quh51c_END --><!-- HEAD_svelte-170d11p_START --><meta content="Building an i18n library for the modern Web" name=og:title><meta content="Building an i18n library for the modern Web" name=twitter:title><meta content=website name=og:type> <meta content=/og/Building%20an%20i18n%20library%20for%20the%20modern%20Web.png name=og:image><link href=/_app/immutable/assets/favicon.BtYv9CGA.png rel=icon><meta content="The rise of metaframeworks with partial hydration has raised some interesting challenges for i18n libraries. This article explores how ParaglideJS attempts to tackle them." name=description><meta content="Loris Sigrist" name=author><meta content=2024-02-01T00:00:00.000Z name=date><!-- HEAD_svelte-170d11p_END --> </head> <body data-sveltekit-preload-data=hover> <header class="flex flex-row container justify-between mx-auto print:hidden px-4 py-4"><div class="flex items-center flex-row gap-4" id=header-start data-svelte-h=svelte-1la7e6x><a href=/ class="flex items-center flex-row gap-3"><picture><source srcset="/_app/immutable/assets/avatar.Bf4TRO7F.avif, /_app/immutable/assets/avatar.BkqM9Qx8.avif 2x" type=image/avif><source srcset="/_app/immutable/assets/avatar.B39wt1fA.webp, /_app/immutable/assets/avatar.D9hkS3v8.webp 2x" type=image/webp><source srcset="/_app/immutable/assets/avatar.nNTP_Lha.png, /_app/immutable/assets/avatar.B3igIkfZ.png 2x" type=image/png><img alt="Loris Sigrist looking very handsome" class="aspect-square rounded-full w-9" height=412 src=/_app/immutable/assets/avatar.B3igIkfZ.png width=412></picture> <span class="font-bold text-md">Loris Sigrist</span></a></div> <div class="flex items-center gap-2 flex-row sm:gap-4" id=header-end><a href=https://dithering.sigrist.dev target=_blank class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" data-svelte-h=svelte-1ilvshw><span class="hidden sm:block">Dither Studio</span></a> <a href=https://zocker.sigrist.dev/ target=_blank class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" data-svelte-h=svelte-1tefg7x><span class="hidden sm:block">Zocker</span></a> <a href=https://t18s.sigrist.dev/ target=_blank class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" data-svelte-h=svelte-1spq4jh><span class="hidden sm:block">t18s</span></a> <a href=https://www.github.com/LorisSigrist target=_blank class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800"><span><svg class="h-4 w-4" fill=none height=1024 viewBox="0 0 1024 1024" width=1024 xmlns=http://www.w3.org/2000/svg><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" clip-rule=evenodd fill=currentColor fill-rule=evenodd transform=scale(64)></path></svg></span> <span class="hidden sm:block" data-svelte-h=svelte-1ob2gl>Github</span></a> <a href=mailto:loris@sigrist.dev class="flex items-center gap-2 rounded-md bg-black dark:bg-white dark:text-black md:px-3 px-1 py-1 text-white"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5><path d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" stroke-linecap=round stroke-linejoin=round></path></svg> <span class="hidden md:block" data-svelte-h=svelte-lz17j7>Contact</span></a> <button class="rounded-md hover:bg-gray-100 hover:dark:bg-gray-800 aspect-square p-2" title="Toggle Theme"> <div class="contents dark:hidden"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=light><path d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" stroke-linecap=round stroke-linejoin=round></path></svg></div> <div class="hidden dark:contents"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=dark><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" stroke-linecap=round stroke-linejoin=round></path></svg></div></button></div></header> <article class="container mx-auto px-4 dark:prose-invert max-w-[70ch] my-8 print:m-0 print:p-0 print:w-100 prose prose-slate"><h1 data-svelte-h=svelte-nwsd6t id=building-an-i18n-library-for-the-modern-web><a href=#building-an-i18n-library-for-the-modern-web>Building an i18n library for the modern Web</a></h1> <p data-svelte-h=svelte-1c1bczr>Over the last few years we’ve seen the emergence of “partial hydration” patterns across many frameworks. The idea is that most rendering happens on the server, with only the interactive parts of a page actually shipping code to the client. The client and server <em>cooperate</em> to show a user a site. This idea has come in many iterations, be it React Server Components, Astro Islands, or even HTMX.</p> <p data-svelte-h=svelte-j92q2m>This has some interesting implications for i18n libraries.</p> <ul data-svelte-h=svelte-1b02cmv><li><ol><li>Since the server-rendered and client-rendered parts always share the same language, language state is <em>global</em>. The only way to switch languages is to rerender everything, including the server-rendered parts, which can only be done by fully reloading the page. Thus, any form of message reactivity or language lazy-loading is useless.</ol></li> <li><ol start=2><li>Most Translations are rendered on the server & don’t depend on client side state</ol> <ul><li>On the server, any i18n library really serves as a templating helper, so they should excel at doing that!</li> <li>Since only a minority of messages will include client side state, the bundle shipped by an i18n library should only include those messages and the code they require.</ul></ul> <h2 data-svelte-h=svelte-1uw3kpc id=the-status-quo><a href=#the-status-quo>The Status Quo</a></h2> <p data-svelte-h=svelte-8g4jzw>Most i18n libraries are still conceptualised as monoliths that do all the work in the same place. Language Detection, Message Fallbacks, Lazy Loading & so many more features. However, doing all the work in one place usually means doing it <strong>twice</strong>! Once on the server and again on the client. This has resulted in some truly impressive bundle sizes. <code>i18next</code>, one of the most popular i18n libraries needs over 40kB to render a single message. This is after bundling.</p> <p data-svelte-h=svelte-ia1wab>Clearly there is a lot of room for improvement.</p> <h2 data-svelte-h=svelte-vrr57j id=a-modern-i18n-library><a href=#a-modern-i18n-library>A modern i18n library</a></h2> <p data-svelte-h=svelte-9lzziv>What would an i18n library look like that embraces the cooperation between Server and Client, that’s built for partial hydration?</p> <p data-svelte-h=svelte-j89qxe>That’s exactly what <a href=https://www.inlang.com target=_blank rel="noopener noreferrer">we</a> tried to accomplish with <a href=https://inlang.com/m/gerre34r/library-inlang-paraglideJs target=_blank rel="noopener noreferrer">ParaglideJS</a></p> <p data-svelte-h=svelte-ft7ejr>Paraglide is a compiler that <em>compiles</em> your messages into JS modules. Each message is it’s own export.</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#758575DD>// @filename: paraglide/messages.js</span></span>
<span class=line><span style=color:#758575DD>/**</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>{ name: string }</span><span style=color:#666>}</span><span style=color:#bd976a> params</span></span>
<span class=line><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#4d9375>export</span><span style=color:#cb7676> const</span><span style=color:#80a665> greeting</span><span style=color:#666> =</span><span style=color:#666> (</span><span style=color:#bd976a>params</span><span style=color:#666>)</span><span style=color:#666> =></span><span style=color:#c98A7D99> `</span><span style=color:#c98a7d>Hello </span><span style=color:#666>${</span><span style=color:#c98a7d>params</span><span style=color:#666>.</span><span style=color:#c98a7d>name</span><span style=color:#666>}</span><span style=color:#c98A7D99>`</span></span>
<span class=line></span>
<span class=line><span style=color:#4d9375>export</span><span style=color:#cb7676> const</span><span style=color:#80a665> my_other_message</span><span style=color:#666> =</span><span style=color:#666> ()</span><span style=color:#666> =></span><span style=color:#c98A7D99> `</span><span style=color:#c98a7d>My Other Message</span><span style=color:#c98A7D99>`</span></span>
<span class=line><span style=color:#758575DD>// ...</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-1mu4d2v>This takes advantage of modern tooling.</p> <ol data-svelte-h=svelte-1gandop><li>TypeScript. Messages are fully type-safe, including any parameters they take. This makes Paraglide a joy to use for templating.</li> <li>Modern Build tools remove JS code that isn’t used automatically. Because messages are individual JS exports, they can individually be removed if they aren’t used. This automatically only ships messages that are needed on the client. This results in some <em>tiny</em> bundle-sizes, starting as low as 100 bytes.</ol> <p data-svelte-h=svelte-fcnch1>We can further take advantage of the cooperation between server and client to skip language detection on the client entirely. Because the server already decided which language to render, the client bundle can just read which language was used from the HTML.</p> <p data-svelte-h=svelte-pfgajt>Because <a href=https://inlang.com/m/gerre34r/library-inlang-paraglideJs target=_blank rel="noopener noreferrer">ParaglideJS</a>is a compiler, fallback messages can be resolved at build time, so no runtime code is needed for that.</p> <p data-svelte-h=svelte-1tgratn>So far, this approach is working very well in any partial-hydration setting. However, even in frameworks without partial hydration <a href=https://inlang.com/m/gerre34r/library-inlang-paraglideJs target=_blank rel="noopener noreferrer">ParaglideJS</a> can still be useful. It still only ships messages that are used on a given <em>page</em> without you needing to manually split messages into namespaces as you usually would.</p> <h2 data-svelte-h=svelte-kmpttn id=conclusion><a href=#conclusion>Conclusion</a></h2> <p data-svelte-h=svelte-kvpqci>Going forward, scaling <em>down</em> and integration with modern tooling is going to be increasingly important for i18n libraries. <a href=https://inlang.com/m/gerre34r/library-inlang-paraglideJs target=_blank rel="noopener noreferrer">ParaglideJS</a> is one attempt at this which can be used <em>today</em>. Clearly there is a lot of room for innovation in this space & we’re interested in how it will develop over the next few months and years.</article> <div class="bg-blue-700 h-3 progress-bar svelte-co5fg3"></div> <script>{__sveltekit_137wv6f={base:new URL(".",location).pathname.slice(0,-1)};let r=document.currentScript.parentElement,a=[null,null,null,{type:"data",data:{title:"Building an i18n library for the modern Web",description:"The rise of metaframeworks with partial hydration has raised some interesting challenges for i18n libraries. This article explores how ParaglideJS attempts to tackle them.",published:new Date(17067456e5),author:"Loris Sigrist"},uses:{}}];Promise.all([import("./_app/immutable/entry/start.wLMQjKKE.js"),import("./_app/immutable/entry/app.cPRhK7hZ.js")]).then(([e,t])=>{e.start(t,r,{node_ids:[0,2,3,7],data:a,form:null,error:null})}),"serviceWorker"in navigator&&addEventListener("load",function(){navigator.serviceWorker.register("./service-worker.js")})}</script> 
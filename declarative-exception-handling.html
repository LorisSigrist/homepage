<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width" name=viewport> <link href=./_app/immutable/assets/Metadata.DyfCrczt.css rel=stylesheet> <link href=./_app/immutable/assets/3.CqjOwtjT.css rel=stylesheet> <link href=./_app/immutable/entry/start.a6wLMBop.js rel=modulepreload> <link href=./_app/immutable/chunks/entry.CWFWTfPT.js rel=modulepreload> <link href=./_app/immutable/chunks/scheduler.DwkGEAYb.js rel=modulepreload> <link href=./_app/immutable/chunks/index.CU0sutvA.js rel=modulepreload> <link href=./_app/immutable/entry/app.C10Q0h0b.js rel=modulepreload> <link href=./_app/immutable/chunks/preload-helper.CP-VSAQc.js rel=modulepreload> <link href=./_app/immutable/chunks/index.BoYP9eQs.js rel=modulepreload> <link href=./_app/immutable/nodes/0.CMIPQFkk.js rel=modulepreload> <link href=./_app/immutable/nodes/2.3MdJPXkR.js rel=modulepreload> <link href=./_app/immutable/chunks/Metadata.D_uBQitJ.js rel=modulepreload> <link href=./_app/immutable/chunks/stores.SXXWI2Hd.js rel=modulepreload> <link href=./_app/immutable/chunks/each.CuygwpM4.js rel=modulepreload> <link href=./_app/immutable/chunks/theme.COyUI6g7.js rel=modulepreload> <link href=./_app/immutable/nodes/3.BMPqw2Om.js rel=modulepreload> <link href=./_app/immutable/nodes/8.B93vpB-O.js rel=modulepreload><title>Declarative Exception Handling in JavaScript</title><!-- HEAD_svelte-1quh51c_START --><script data-svelte-h=svelte-ctkbxh>if("localStorage"in window){let e="dark"===localStorage.getItem("theme"),t="light"===localStorage.getItem("theme"),a=!e&&!t;if(e)document.documentElement.classList.add("dark");else if(t)document.documentElement.classList.remove("dark");else if(a){let e=window.matchMedia("(prefers-color-scheme: dark)");e.matches?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))}}</script><!-- HEAD_svelte-1quh51c_END --><!-- HEAD_svelte-170d11p_START --><meta content="Declarative Exception Handling in JavaScript" name=og:title><meta content="Declarative Exception Handling in JavaScript" name=twitter:title><meta content=website name=og:type> <meta content=/og/Declarative%20Exception%20Handling%20in%20JavaScript.png name=og:image><link href=/_app/immutable/assets/favicon.BtYv9CGA.png rel=icon><meta content="Handling many different exception types in JavaScript is a pain. In this article we will play around with a declarative approach to exception handling." name=description><meta content="Loris Sigrist" name=author><meta content=2023-10-12T00:00:00.000Z name=date><!-- HEAD_svelte-170d11p_END --> </head> <body data-sveltekit-preload-data=hover> <header class="flex flex-row container justify-between mx-auto print:hidden px-4 py-4"><div class="flex items-center flex-row gap-4" id=header-start data-svelte-h=svelte-1la7e6x><a href=/ class="flex items-center flex-row gap-3"><picture><source srcset="/_app/immutable/assets/avatar.CO8mBa3R.avif, /_app/immutable/assets/avatar.CUQxh67W.avif 2x" type=image/avif><source srcset="/_app/immutable/assets/avatar.B39wt1fA.webp, /_app/immutable/assets/avatar.D9hkS3v8.webp 2x" type=image/webp><source srcset="/_app/immutable/assets/avatar.BJCwippg.png, /_app/immutable/assets/avatar.BQIWiNBc.png 2x" type=image/png><img alt="Loris Sigrist looking very handsome" class="aspect-square rounded-full w-9" height=412 src=/_app/immutable/assets/avatar.BQIWiNBc.png width=412></picture> <span class="font-bold text-md">Loris Sigrist</span></a></div> <div class="flex items-center gap-2 flex-row sm:gap-4" id=header-end><a href=https://dithering.sigrist.dev class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1ilvshw><span class="hidden sm:block">Dither Studio</span></a> <a href=https://zocker.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1tefg7x><span class="hidden sm:block">Zocker</span></a> <a href=https://t18s.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1spq4jh><span class="hidden sm:block">t18s</span></a> <a href=https://www.github.com/LorisSigrist class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank><span><svg class="h-4 w-4" fill=none height=1024 viewBox="0 0 1024 1024" width=1024 xmlns=http://www.w3.org/2000/svg><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" clip-rule=evenodd fill=currentColor fill-rule=evenodd transform=scale(64)></path></svg></span> <span class="hidden sm:block" data-svelte-h=svelte-1ob2gl>Github</span></a> <a href=mailto:loris@sigrist.dev class="flex items-center gap-2 rounded-md bg-black dark:bg-white dark:text-black md:px-3 px-1 py-1 text-white"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true data-slot=icon stroke=currentColor stroke-width=1.5><path d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" stroke-linecap=round stroke-linejoin=round></path></svg> <span class="hidden md:block" data-svelte-h=svelte-lz17j7>Contact</span></a> <button class="rounded-md hover:bg-gray-100 hover:dark:bg-gray-800 aspect-square p-2" title="Toggle Theme"> <div class="contents dark:hidden"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true data-slot=icon stroke=currentColor stroke-width=1.5 slot=light><path d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" stroke-linecap=round stroke-linejoin=round></path></svg></div> <div class="hidden dark:contents"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true data-slot=icon stroke=currentColor stroke-width=1.5 slot=dark><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" stroke-linecap=round stroke-linejoin=round></path></svg></div></button></div></header> <article class="container mx-auto px-4 dark:prose-invert max-w-[70ch] my-8 print:m-0 print:p-0 print:w-100 prose prose-slate"><h1 data-svelte-h=svelte-z0u4rw id=declarative-exception-handling><a href=#declarative-exception-handling>Declarative Exception Handling</a></h1> <p data-svelte-h=svelte-xe0fn0>In this article we will explore a potential remedy to the nightmare that is error handling in JS.</p> <h2 data-svelte-h=svelte-xa1j4 id=the-state-of-error-handling-in-js><a href=#the-state-of-error-handling-in-js>The State of Error Handling in JS</a></h2> <p data-svelte-h=svelte-j0y3la>If you have a function that might fail, you would probably do something like this.</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark lsp twoslash" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>let </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666>;</span></span>
<span class=line><span style=color:#4d9375>try</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#cb7676>  const </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#bd976a>user</span><span style=color:#666>: {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666> =</span><span style=color:#80a665> </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#80a665>unsafe</span><span style=color:#666>: () => {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>unsafe</span></span><span style=color:#666>();</span></span>
<span class=line><span style=color:#bd976a>  </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#bd976a>user</span><span style=color:#666>: {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666>.</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>name</span><span style=color:#666>:</span><span style=color:#bd976a> string</span></code></span>name</span></span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span><span style=color:#4d9375> catch</span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>e</span><span style=color:#666>: </span><span style=color:#5da994>unknown</span></code></span>e</span></span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#bd976a>  </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#cb7676> null</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-1o7ycng>This very common implementation has a bug though. It handles all exceptions, not just the ones we expect to happen during normal operation. If <code>unsafe</code> has a Syntax error in it’s implementation this would silently swallow it. We don’t want that.</p> <p data-svelte-h=svelte-7telbu>A better implementation would be to throw custom error-types for all your expected exceptions and test anything that’s thrown against those.</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark lsp twoslash" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>class</span><span style=color:#5da994> </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException1</span></code></span>CustomException1</span></span><span style=color:#cb7676> extends</span><span style=color:#80a665> </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>Error</span><span style=color:#666>: </span><span style=color:#5da994>ErrorConstructor</span></code></span>Error</span></span><span style=color:#666> {}</span></span>
<span class=line><span style=color:#cb7676>class</span><span style=color:#5da994> </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException2</span></code></span>CustomException2</span></span><span style=color:#cb7676> extends</span><span style=color:#80a665> </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>Error</span><span style=color:#666>: </span><span style=color:#5da994>ErrorConstructor</span></code></span>Error</span></span><span style=color:#666> {}</span></span>
<span class=line></span>
<span class=line><span style=color:#cb7676>let </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666>;</span></span>
<span class=line><span style=color:#4d9375>try</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#cb7676>   const </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#bd976a>user</span><span style=color:#666>: {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666> =</span><span style=color:#80a665> </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#80a665>unsafe</span><span style=color:#666>: () => {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>unsafe</span></span><span style=color:#666>();</span><span style=color:#758575DD> //throws CustomException1 & 2</span></span>
<span class=line><span style=color:#bd976a>   </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#bd976a>user</span><span style=color:#666>: {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666>.</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>name</span><span style=color:#666>:</span><span style=color:#bd976a> string</span></code></span>name</span></span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span><span style=color:#4d9375> catch</span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>e</span><span style=color:#666>: </span><span style=color:#5da994>unknown</span></code></span>e</span></span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>  if</span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>e</span><span style=color:#666>: </span><span style=color:#5da994>unknown</span></code></span>e</span></span><span style=color:#cb7676> instanceof</span><span style=color:#5da994> </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException1</span></code></span>CustomException1</span></span><span style=color:#666>)</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#cb7676> null</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#4d9375>  else</span><span style=color:#4d9375> if</span><span style=color:#666> (</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>e</span><span style=color:#666>: </span><span style=color:#5da994>unknown</span></code></span>e</span></span><span style=color:#cb7676> instanceof</span><span style=color:#5da994> </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException2</span></code></span>CustomException2</span></span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#bd976a>    </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>console</span><span style=color:#666>: </span><span style=color:#5da994>Console</span></code></span>console</span></span><span style=color:#666>.</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#bd976a>Console</span><span style=color:#666>.</span><span style=color:#80a665>warn</span><span style=color:#666>(...</span><span style=color:#bd976a>data</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>any</span><span style=color:#666>[])</span><span style=color:#dbd7CAEE>: </span><span style=color:#cb7676>void</span></code></span>warn</span></span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>CustomeException2</span><span style=color:#c98A7D99>"</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#bd976a>    </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>let </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>any</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#cb7676> null</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line><span style=color:#4d9375>  else</span><span style=color:#4d9375> throw</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>e</span><span style=color:#666>: </span><span style=color:#5da994>unknown</span></code></span>e</span></span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-1kgaj31>But the code here gets really really ugly really really fast. We have to imperatively check which Execution path we should take, opening up the door to many silly bugs.</p> <h2 data-svelte-h=svelte-kzejms id=what-we-want><a href=#what-we-want>What we want</a></h2> <p data-svelte-h=svelte-dvkkc4>Wouldn’t it be really nice if we could declaratively define each execution path an the right thing just happened? Other languages like Rust would make this pretty easy using Errors-As-Values and <code>match</code> statements. Something like this:</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>let</span><span style=color:#bd976a> result</span><span style=color:#666> =</span><span style=color:#4d9375> match</span><span style=color:#80a665> unsafe_fn</span><span style=color:#666>()</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#5da994>    Ok</span><span style=color:#666>(</span><span style=color:#bd976a>user</span><span style=color:#666>)</span><span style=color:#cb7676> =></span><span style=color:#bd976a> user</span><span style=color:#cb7676>.</span><span style=color:#dbd7CAEE>name</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#5da994>    Err</span><span style=color:#666>(</span><span style=color:#5da994>CustomExceptions</span><span style=color:#cb7676>::</span><span style=color:#4c9a91>1</span><span style=color:#666>)</span><span style=color:#cb7676> =></span><span style=color:#bd976a> null</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#5da994>    Err</span><span style=color:#666>(</span><span style=color:#5da994>CustomExceptions</span><span style=color:#cb7676>::</span><span style=color:#4c9a91>2</span><span style=color:#666>)</span><span style=color:#cb7676> =></span><span style=color:#666> {</span></span>
<span class=line><span style=color:#80a665>      print!</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>CustomeException2</span><span style=color:#c98A7D99>"</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#bd976a>      null</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>    },</span></span>
<span class=line><span style=color:#5da994>    Err</span><span style=color:#666>(</span><span style=color:#bd976a>error</span><span style=color:#666>)</span><span style=color:#cb7676> =></span><span style=color:#80a665> panic!</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>Unexpected Error: </span><span style=color:#666>{</span><span style=color:#c98a7d>:?</span><span style=color:#666>}</span><span style=color:#c98A7D99>"</span><span style=color:#666>,</span><span style=color:#bd976a> error</span><span style=color:#666>),</span></span>
<span class=line><span style=color:#666>};</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-xy7f4b>This way we can declaratively define each possible execution branch, drastically reducing the chance of bugs.</p> <h2 data-svelte-h=svelte-9hqu1k id=resultmatcher-a-potential-solution><a href=#resultmatcher-a-potential-solution><code>ResultMatcher</code> a potential solution</a></h2> <p data-svelte-h=svelte-tiiv16>I took a stab at implementing a similar API in JS, and I came up with the <code>ResultMatcher</code> class. You can find the full source code at the bottom of this article. It is used like this:</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark lsp twoslash" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>const </span><span style=color:#bd976a>result</span><span style=color:#666>: </span><span style=color:#5da994>void</span></code></span>result</span></span><span style=color:#666> =</span><span style=color:#cb7676> new </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#bd976a>constructor</span><span style=color:#80a665> ResultMatcher</span><span style=color:#666>(</span><span style=color:#bd976a>data</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>any</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>ResultMatcher</span></code></span>ResultMatcher</span></span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>const </span><span style=color:#80a665>unsafe</span><span style=color:#666>: () => {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>unsafe</span></span><span style=color:#666>)</span></span>
<span class=line><span style=color:#666>    .</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#bd976a>ResultMatcher</span><span style=color:#666>.</span><span style=color:#80a665>ok</span><span style=color:#666>(</span><span style=color:#bd976a>cb</span><span style=color:#dbd7CAEE>: </span><span style=color:#666>(</span><span style=color:#bd976a>user</span><span style=color:#666>: {</span></span>
<span class=line><span style=color:#bd976a>    name</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>})</span><span style=color:#666> =></span><span style=color:#bd976a> any</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>ResultMatcher</span></span></code></pre></code></span>ok</span></span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#80a665>user</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#80a665>    name</span><span style=color:#666>:</span><span style=color:#bd976a> string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666> =></span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#80a665>user</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#80a665>    name</span><span style=color:#666>:</span><span style=color:#bd976a> string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>user</span></span><span style=color:#666>.</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>name</span><span style=color:#666>:</span><span style=color:#bd976a> string</span></code></span>name</span></span><span style=color:#666>)</span></span>
<span class=line><span style=color:#666>    .</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#bd976a>ResultMatcher</span><span style=color:#666>.</span><span style=color:#80a665>catch</span><span style=color:#666>&lt;</span><span style=color:#5da994>CustomException1</span><span style=color:#666>>(</span><span style=color:#bd976a>prototype</span><span style=color:#dbd7CAEE>: </span><span style=color:#666>(</span><span style=color:#cb7676>new</span><span style=color:#666> ()</span><span style=color:#666> =></span><span style=color:#bd976a> CustomException1</span><span style=color:#666>)</span><span style=color:#cb7676> |</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#b8a965>    prototype</span><span style=color:#666>: </span><span style=color:#bd976a>CustomException1</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>},</span><span style=color:#bd976a> cb</span><span style=color:#dbd7CAEE>: </span><span style=color:#666>(</span><span style=color:#bd976a>instance</span><span style=color:#666>: </span><span style=color:#5da994>CustomException1</span><span style=color:#666>)</span><span style=color:#666> =></span><span style=color:#bd976a> any</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>ResultMatcher</span></span></code></pre></code></span>catch</span></span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException1</span></code></span>CustomException1</span></span><span style=color:#666>,</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>e</span><span style=color:#666>:</span><span style=color:#bd976a> CustomException1</span></code></span>e</span></span><span style=color:#666> =></span><span style=color:#cb7676> null</span><span style=color:#666>)</span></span>
<span class=line><span style=color:#666>    .</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#bd976a>ResultMatcher</span><span style=color:#666>.</span><span style=color:#80a665>catch</span><span style=color:#666>&lt;</span><span style=color:#5da994>CustomException2</span><span style=color:#666>>(</span><span style=color:#bd976a>prototype</span><span style=color:#dbd7CAEE>: </span><span style=color:#666>(</span><span style=color:#cb7676>new</span><span style=color:#666> ()</span><span style=color:#666> =></span><span style=color:#bd976a> CustomException2</span><span style=color:#666>)</span><span style=color:#cb7676> |</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#b8a965>    prototype</span><span style=color:#666>: </span><span style=color:#bd976a>CustomException2</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>},</span><span style=color:#bd976a> cb</span><span style=color:#dbd7CAEE>: </span><span style=color:#666>(</span><span style=color:#bd976a>instance</span><span style=color:#666>: </span><span style=color:#5da994>CustomException2</span><span style=color:#666>)</span><span style=color:#666> =></span><span style=color:#bd976a> any</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>ResultMatcher</span></span></code></pre></code></span>catch</span></span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> CustomException2</span></code></span>CustomException2</span></span><span style=color:#666>,</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>e</span><span style=color:#666>:</span><span style=color:#bd976a> CustomException2</span></code></span>e</span></span><span style=color:#666> =></span><span style=color:#666> {</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>var </span><span style=color:#bd976a>console</span><span style=color:#666>: </span><span style=color:#5da994>Console</span></code></span>console</span></span><span style=color:#666>.</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#bd976a>Console</span><span style=color:#666>.</span><span style=color:#80a665>warn</span><span style=color:#666>(...</span><span style=color:#bd976a>data</span><span style=color:#dbd7CAEE>: </span><span style=color:#bd976a>any</span><span style=color:#666>[])</span><span style=color:#dbd7CAEE>: </span><span style=color:#cb7676>void</span></code></span>warn</span></span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>CustomException2</span><span style=color:#c98A7D99>"</span><span style=color:#666>);</span><span style=color:#4d9375> return</span><span style=color:#cb7676> null</span><span style=color:#666>})</span></span>
<span class=line><span style=color:#666>    .</span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#bd976a>ResultMatcher</span><span style=color:#666>.</span><span style=color:#80a665>run</span><span style=color:#666>()</span><span style=color:#dbd7CAEE>: </span><span style=color:#cb7676>void</span></code></span>run</span></span><span style=color:#666>()</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-h0ke80>It is fully typesafe making it a breeze to work with.</p> <p data-svelte-h=svelte-aex9p>Let’s take a look at each part:</p> <ul data-svelte-h=svelte-1rlehpz><li><code>const result</code> will be the return value of whatever execution branch is taken. In the snippet above the return type would be <code>string | null</code></li> <li><code>ResultMatcher(unsafe)</code> constructs a matcher instance for the function <code>unsafe</code></li> <li><code>.ok()</code> takes a callback that handles the return value of <code>unsafe</code> if it succeeds. If <code>.ok</code> is not used on the Matcher it will default to the identity function.</li> <li><code>.catch(CustomException1, e => null)</code> Will only run if <code>unsafe</code> throws a <code>CustomException1</code>. It may return a value.</li> <li><code>.run()</code> Actually calls <code>unsafe</code>. If unsafe takes args, you will pass them here (Eg: <code>run("Hello", {option: "a"})</code>). TS will enforce this.</ul> <p data-svelte-h=svelte-12ouq9h>Sometimes you <em>do</em> want to react to all errors that are thrown. Maybe just to log them. For that we have the <code>catchAll</code> method.</p> <ul data-svelte-h=svelte-1fgu1t0><li><code>.catchAll(e => {console.error(e); throw e})</code></ul> <h2 data-svelte-h=svelte-1m2hw0c id=the-snippet><a href=#the-snippet>The Snippet</a></h2> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#758575DD>/**</span></span>
<span class=line><span style=color:#758575DD> * The configuration for a ResultMatcher Strategy.</span></span>
<span class=line><span style=color:#758575DD> *</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> Prototype</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> ReturnType</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>typedef</span><span style=color:#666> {</span><span style=color:#5da994>{</span></span>
<span class=line><span style=color:#5da994> *    prototype: { new (): Prototype;  } | { prototype: Prototype; },</span></span>
<span class=line><span style=color:#5da994> *    handler: (instance: Prototype) => ReturnType;</span></span>
<span class=line><span style=color:#5da994> * }</span><span style=color:#666>}</span><span style=color:#5da994> Strategy</span></span>
<span class=line><span style=color:#758575DD> */</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>/**</span></span>
<span class=line><span style=color:#758575DD> * Declaratively define what should happen for all the possible outcomes of a function.</span></span>
<span class=line><span style=color:#758575DD> * This follows an immutable builder pattern, so each method returns a new instance of the ResultMatcher class.</span></span>
<span class=line><span style=color:#758575DD> *</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>(...args: any) => any</span><span style=color:#666>}</span><span style=color:#bd976a> UnsafeFunc</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>(result: ReturnType&lt;UnsafeFunc>) => any</span><span style=color:#666>}</span><span style=color:#758575DD> [</span><span style=color:#bd976a>SuccessHandler</span><span style=color:#758575DD>=((result: ReturnType&lt;UnsafeFunc>) => ReturnType&lt;UnsafeFunc>)]</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>Strategy&lt;any, any>[]</span><span style=color:#666>}</span><span style=color:#758575DD> [</span><span style=color:#bd976a>Strategies</span><span style=color:#758575DD>=[]]</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>((e: unknown) => any)</span><span style=color:#666>}</span><span style=color:#758575DD> [</span><span style=color:#bd976a>FallbackHandler</span><span style=color:#758575DD>=(e: unknown) => never]</span></span>
<span class=line><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#4d9375>export</span><span style=color:#cb7676> class</span><span style=color:#5da994> ResultMatcher</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#758575DD>  /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>UnsafeFunc</span><span style=color:#666>}</span><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#bd976a>  #unsafeFunction</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>Strategies</span><span style=color:#666>}</span><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#bd976a>  #strategies</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>SuccessHandler</span><span style=color:#666>}</span><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#bd976a>  #successHandler</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>FallbackHandler</span><span style=color:#666>}</span><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#bd976a>  #fallbackHandler</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /**</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>UnsafeFunc</span><span style=color:#666>}</span><span style=color:#bd976a> func</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>Strategies</span><span style=color:#666>}</span><span style=color:#bd976a> strategies</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>SuccessHandler</span><span style=color:#666>}</span><span style=color:#bd976a> successHandler</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>FallbackHandler</span><span style=color:#666>}</span><span style=color:#bd976a> fallbackHandler</span></span>
<span class=line><span style=color:#758575DD>   */</span></span>
<span class=line><span style=color:#cb7676>  constructor</span><span style=color:#666>(</span></span>
<span class=line><span style=color:#bd976a>    func</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#bd976a>    strategies</span><span style=color:#666> =</span><span style=color:#758575DD> /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>any</span><span style=color:#666>}</span><span style=color:#758575DD> */</span><span style=color:#666> ([]),</span></span>
<span class=line><span style=color:#bd976a>    successHandler</span><span style=color:#666> =</span><span style=color:#758575DD> /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>any</span><span style=color:#666>}</span><span style=color:#758575DD> */</span><span style=color:#666> (</span><span style=color:#bd976a>identity</span><span style=color:#666>),</span></span>
<span class=line><span style=color:#bd976a>    fallbackHandler</span><span style=color:#666> =</span><span style=color:#758575DD> /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>any</span><span style=color:#666>}</span><span style=color:#758575DD> */</span><span style=color:#666> (</span><span style=color:#bd976a>raise</span><span style=color:#666>),</span></span>
<span class=line><span style=color:#666>  )</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c99076>    this</span><span style=color:#666>.</span><span style=color:#bd976a>#unsafeFunction</span><span style=color:#666> =</span><span style=color:#bd976a> func</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#c99076>    this</span><span style=color:#666>.</span><span style=color:#bd976a>#strategies</span><span style=color:#666> =</span><span style=color:#bd976a> strategies</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#c99076>    this</span><span style=color:#666>.</span><span style=color:#bd976a>#successHandler</span><span style=color:#666> =</span><span style=color:#bd976a> successHandler</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#c99076>    this</span><span style=color:#666>.</span><span style=color:#bd976a>#fallbackHandler</span><span style=color:#666> =</span><span style=color:#bd976a> fallbackHandler</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /**</span></span>
<span class=line><span style=color:#758575DD>   * Defines a strategy for a given error type.</span></span>
<span class=line><span style=color:#758575DD>   *</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> Prototype</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> StrategyReturnType</span></span>
<span class=line><span style=color:#758575DD>   *</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>{ new (): Prototype;} | { prototype: Prototype; }</span><span style=color:#666>}</span><span style=color:#bd976a> prototype</span><span style=color:#758575DD> - The error type to handle. Thrown things will be compared against this with `instanceof`.</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>(instance: Prototype) => StrategyReturnType</span><span style=color:#666>}</span><span style=color:#bd976a> handler</span><span style=color:#758575DD> - Callback to handle the error.</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>ResultMatcher&lt;UnsafeFunc, SuccessHandler, [...Strategies, Strategy&lt;Prototype, StrategyReturnType>], FallbackHandler></span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD>   */</span></span>
<span class=line><span style=color:#80a665>  catch</span><span style=color:#666>(</span><span style=color:#bd976a>prototype</span><span style=color:#666>,</span><span style=color:#bd976a> handler</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#cb7676>    const</span><span style=color:#bd976a> registeredStrategy</span><span style=color:#666> =</span><span style=color:#666> {</span><span style=color:#bd976a> prototype</span><span style=color:#666>,</span><span style=color:#bd976a> handler</span><span style=color:#666> };</span></span>
<span class=line><span style=color:#4d9375>    return</span><span style=color:#cb7676> new</span><span style=color:#80a665> ResultMatcher</span><span style=color:#666>(</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#unsafeFunction</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#666>      [...</span><span style=color:#c99076>this</span><span style=color:#666>.</span><span style=color:#bd976a>#strategies</span><span style=color:#666>,</span><span style=color:#bd976a> registeredStrategy</span><span style=color:#666>],</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#successHandler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#fallbackHandler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#666>    );</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /**</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>(e:unknown) => any</span><span style=color:#666>}</span><span style=color:#bd976a> Handler</span></span>
<span class=line><span style=color:#758575DD>   *</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>Handler</span><span style=color:#666>}</span><span style=color:#bd976a> handler</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>ResultMatcher&lt;UnsafeFunc, SuccessHandler, Strategies, Handler></span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD>   */</span></span>
<span class=line><span style=color:#80a665>  catchAll</span><span style=color:#666>(</span><span style=color:#bd976a>handler</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>    return</span><span style=color:#cb7676> new</span><span style=color:#80a665> ResultMatcher</span><span style=color:#666>(</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#unsafeFunction</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#strategies</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#successHandler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#bd976a>      handler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#666>    );</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /**</span></span>
<span class=line><span style=color:#758575DD>   * Handle the happy path</span></span>
<span class=line><span style=color:#758575DD>   *</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#666> {</span><span style=color:#5da994>(result: ReturnType&lt;UnsafeFunc>) => any</span><span style=color:#666>}</span><span style=color:#bd976a> Handler</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>Handler</span><span style=color:#666>}</span><span style=color:#bd976a> handler</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>ResultMatcher&lt;UnsafeFunc, Handler, Strategies, FallbackHandler></span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD>   */</span></span>
<span class=line><span style=color:#80a665>  ok</span><span style=color:#666>(</span><span style=color:#bd976a>handler</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>    return</span><span style=color:#cb7676> new</span><span style=color:#80a665> ResultMatcher</span><span style=color:#666>(</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#unsafeFunction</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#strategies</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#bd976a>      handler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c99076>      this</span><span style=color:#666>.</span><span style=color:#bd976a>#fallbackHandler</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#666>    );</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>  /**</span></span>
<span class=line><span style=color:#758575DD>   * Calls the unsafe function with the given parameters and handles any errors that may be thrown</span></span>
<span class=line><span style=color:#758575DD>   * according to the registered strategies.</span></span>
<span class=line><span style=color:#758575DD>   *</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666>  {</span><span style=color:#5da994>Parameters&lt;UnsafeFunc></span><span style=color:#666>}</span><span style=color:#bd976a> params</span></span>
<span class=line><span style=color:#758575DD>   * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>ReturnType&lt;SuccessHandler> | ReturnType&lt;Strategies[number]["handler"]> | ReturnType&lt;FallbackHandler></span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD>   */</span></span>
<span class=line><span style=color:#80a665>  run</span><span style=color:#666>(...</span><span style=color:#bd976a>params</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#cb7676>    let</span><span style=color:#bd976a> successResult</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#4d9375>    try</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#758575DD>      // @ts-ignore</span></span>
<span class=line><span style=color:#bd976a>      successResult</span><span style=color:#666> =</span><span style=color:#c99076> this</span><span style=color:#666>.</span><span style=color:#80a665>#unsafeFunction</span><span style=color:#666>(...</span><span style=color:#bd976a>params</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#666>    }</span><span style=color:#4d9375> catch</span><span style=color:#666> (</span><span style=color:#bd976a>e</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>      for</span><span style=color:#666> (</span><span style=color:#cb7676>const</span><span style=color:#bd976a> strategy</span><span style=color:#cb7676> of</span><span style=color:#c99076> this</span><span style=color:#666>.</span><span style=color:#bd976a>#strategies</span><span style=color:#666>)</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>        if</span><span style=color:#666> (</span><span style=color:#bd976a>e</span><span style=color:#cb7676> instanceof</span><span style=color:#758575DD> /** </span><span style=color:#666>@</span><span style=color:#4d9375>type</span><span style=color:#666> {</span><span style=color:#5da994>any</span><span style=color:#666>}</span><span style=color:#758575DD> */</span><span style=color:#666> (</span><span style=color:#5da994>strategy</span><span style=color:#666>.</span><span style=color:#5da994>prototype</span><span style=color:#666>))</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>          return</span><span style=color:#bd976a> strategy</span><span style=color:#666>.</span><span style=color:#80a665>handler</span><span style=color:#666>(</span><span style=color:#bd976a>e</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#666>        }</span></span>
<span class=line><span style=color:#666>      }</span></span>
<span class=line></span>
<span class=line><span style=color:#4d9375>      return</span><span style=color:#c99076> this</span><span style=color:#666>.</span><span style=color:#80a665>#fallbackHandler</span><span style=color:#666>(</span><span style=color:#bd976a>e</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#4d9375>    return</span><span style=color:#c99076> this</span><span style=color:#666>.</span><span style=color:#80a665>#successHandler</span><span style=color:#666>(</span><span style=color:#bd976a>successResult</span><span style=color:#666>);</span></span>
<span class=line><span style=color:#666>  }</span></span>
<span class=line><span style=color:#666>}</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>/**</span></span>
<span class=line><span style=color:#758575DD> * The identity function</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> T</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>T</span><span style=color:#666>}</span><span style=color:#bd976a> x</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>T</span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#cb7676>const</span><span style=color:#80a665> identity</span><span style=color:#666> =</span><span style=color:#666> (</span><span style=color:#bd976a>x</span><span style=color:#666>)</span><span style=color:#666> =></span><span style=color:#bd976a> x</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>/**</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>template</span><span style=color:#bd976a> T</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>param</span><span style=color:#666> {</span><span style=color:#5da994>T</span><span style=color:#666>}</span><span style=color:#bd976a> e</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>returns</span><span style=color:#666> {</span><span style=color:#5da994>never</span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD> * </span><span style=color:#666>@</span><span style=color:#4d9375>throws</span><span style=color:#666> {</span><span style=color:#5da994>T</span><span style=color:#666>}</span></span>
<span class=line><span style=color:#758575DD> */</span></span>
<span class=line><span style=color:#cb7676>const</span><span style=color:#80a665> raise</span><span style=color:#666> =</span><span style=color:#666> (</span><span style=color:#bd976a>e</span><span style=color:#666>)</span><span style=color:#666> =></span><span style=color:#666> {</span></span>
<span class=line><span style=color:#4d9375>  throw</span><span style=color:#bd976a> e</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>};</span></span></code></pre><!-- HTML_TAG_END --></article> <div class="bg-blue-700 h-3 progress-bar svelte-co5fg3"></div> <script>{__sveltekit_isvsk6={base:new URL(".",location).pathname.slice(0,-1)};let a=document.currentScript.parentElement,i=[null,null,null,{type:"data",data:{title:"Declarative Exception Handling in JavaScript",description:"Handling many different exception types in JavaScript is a pain. In this article we will play around with a declarative approach to exception handling.",published:new Date(16970688e5),author:"Loris Sigrist"},uses:{}}];Promise.all([import("./_app/immutable/entry/start.a6wLMBop.js"),import("./_app/immutable/entry/app.C10Q0h0b.js")]).then(([e,t])=>{e.start(t,a,{node_ids:[0,2,3,8],data:i,form:null,error:null})}),"serviceWorker"in navigator&&addEventListener("load",function(){navigator.serviceWorker.register("./service-worker.js")})}</script> 
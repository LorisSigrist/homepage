<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width" name=viewport> <link href=./_app/immutable/assets/Metadata.XOU45X0j.css rel=stylesheet> <link href=./_app/immutable/assets/3._r8Po9UL.css rel=stylesheet> <link href=./_app/immutable/entry/start.C11YVUz3.js rel=modulepreload> <link href=./_app/immutable/chunks/entry.vuD6Erv5.js rel=modulepreload> <link href=./_app/immutable/chunks/scheduler.BdRfwDxj.js rel=modulepreload> <link href=./_app/immutable/chunks/index.dHxtCu-E.js rel=modulepreload> <link href=./_app/immutable/entry/app.YGDPVTZQ.js rel=modulepreload> <link href=./_app/immutable/chunks/preload-helper.0HuHagjb.js rel=modulepreload> <link href=./_app/immutable/chunks/index.DLvNlD75.js rel=modulepreload> <link href=./_app/immutable/nodes/0.DVVM6xgE.js rel=modulepreload> <link href=./_app/immutable/nodes/2.0Gcmq5Jp.js rel=modulepreload> <link href=./_app/immutable/chunks/Metadata.XKGKUz-y.js rel=modulepreload> <link href=./_app/immutable/chunks/stores.by7wQR5J.js rel=modulepreload> <link href=./_app/immutable/chunks/each.6w4Ej4nR.js rel=modulepreload> <link href=./_app/immutable/chunks/theme.M7Te9enT.js rel=modulepreload> <link href=./_app/immutable/nodes/3.JmTqm4pe.js rel=modulepreload> <link href=./_app/immutable/nodes/8.RWj8Ivao.js rel=modulepreload><title>Declarative Exception Handling in JavaScript</title><!-- HEAD_svelte-1quh51c_START --><script data-svelte-h=svelte-ctkbxh>if("localStorage"in window){const a="dark"===localStorage.getItem("theme"),b="light"===localStorage.getItem("theme"),c=!a&&!b;if(a)document.documentElement.classList.add("dark");else if(b)document.documentElement.classList.remove("dark");else if(c){const d=window.matchMedia("(prefers-color-scheme: dark)");d.matches?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))}}</script><!-- HEAD_svelte-1quh51c_END --><!-- HEAD_svelte-170d11p_START --><meta content="Declarative Exception Handling in JavaScript" name=og:title><meta content="Declarative Exception Handling in JavaScript" name=twitter:title><meta content=website name=og:type> <meta content=/og/Declarative%20Exception%20Handling%20in%20JavaScript.png name=og:image><link href=/_app/immutable/assets/favicon.bWL_QhgN.png rel=icon><meta content="Handling many different exception types in JavaScript is a pain. In this article we will play around with a declarative approach to exception handling." name=description><meta content="Loris Sigrist" name=author><meta content=2023-10-12T00:00:00.000Z name=date><!-- HEAD_svelte-170d11p_END --> </head> <body data-sveltekit-preload-data=hover> <header class="flex flex-row container justify-between mx-auto print:hidden px-4 py-4"><div class="flex items-center flex-row gap-4" id=header-start data-svelte-h=svelte-1uvk4ap><a href=/ class="flex items-center flex-row gap-3"><picture><source srcset="/_app/immutable/assets/avatar.jvJgWt0b.avif, /_app/immutable/assets/avatar.lEMYeu1q.avif 2x" type=image/avif><source srcset="/_app/immutable/assets/avatar.d_cLdXwL.webp, /_app/immutable/assets/avatar._YZEt7_I.webp 2x" type=image/webp><source srcset="/_app/immutable/assets/avatar.SQsIqaYL.png, /_app/immutable/assets/avatar.UCFojQXP.png 2x" type=image/png><img alt="Loris Sigrist looking very handsome" class="aspect-square rounded-full w-9" height=412 src=/_app/immutable/assets/avatar.UCFojQXP.png width=412></picture> <span class="font-bold text-md">Loris Sigrist</span></a></div> <div class="flex items-center gap-2 flex-row sm:gap-4" id=header-end><a href=https://dithering.sigrist.dev class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-525hz2><span class="hidden sm:block">Dither Studio</span></a> <a href=https://zocker.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1tefg7x><span class="hidden sm:block">Zocker</span></a> <a href=https://t18s.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1q1lv9r><span class="hidden sm:block">t18s</span></a> <a href=https://www.github.com/LorisSigrist class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank><span><svg class="h-4 w-4" fill=none height=1024 viewBox="0 0 1024 1024" width=1024 xmlns=http://www.w3.org/2000/svg><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" clip-rule=evenodd fill=currentColor fill-rule=evenodd transform=scale(64)></path></svg></span> <span class="hidden sm:block" data-svelte-h=svelte-1ob2gl>Github</span></a> <a href=mailto:loris@sigrist.dev class="flex items-center gap-2 rounded-md bg-black dark:bg-white dark:text-black md:px-3 px-1 py-1 text-white"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5><path d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" stroke-linecap=round stroke-linejoin=round></path></svg> <span class="hidden md:block" data-svelte-h=svelte-lz17j7>Contact</span></a> <button class="rounded-md hover:bg-gray-100 hover:dark:bg-gray-800 aspect-square p-2" title="Toggle Theme"> <div class="contents dark:hidden"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=light><path d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" stroke-linecap=round stroke-linejoin=round></path></svg></div> <div class="hidden dark:contents"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=dark><path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" stroke-linecap=round stroke-linejoin=round></path></svg></div></button></div></header> <article class="container mx-auto px-4 dark:prose-invert max-w-[70ch] my-8 print:m-0 print:p-0 print:w-100 prose prose-slate"><h1 data-svelte-h=svelte-z0u4rw id=declarative-exception-handling><a href=#declarative-exception-handling>Declarative Exception Handling</a></h1> <p data-svelte-h=svelte-xe0fn0>In this article we will explore a potential remedy to the nightmare that is error handling in JS.</p> <h2 data-svelte-h=svelte-xa1j4 id=the-state-of-error-handling-in-js><a href=#the-state-of-error-handling-in-js>The State of Error Handling in JS</a></h2> <p data-svelte-h=svelte-j0y3la>If you have a function that might fail, you would probably do something like this.</p> <pre class=language-js><!-- HTML_TAG_START --><code class=language-js><span class="token keyword">let</span> result<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  result <span class="token operator">=</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token function">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h=svelte-86uv7g>This very common implementation has a bug though. It handles all exceptions, not just the ones we expect to happen during normal operation. If <code>usafe</code> has a Syntax error in it’s implementation this would silently swallow it. We don’t want that.</p> <p data-svelte-h=svelte-7telbu>A better implementation would be to throw custom error-types for all your expected exceptions and test anything that’s thrown against those.</p> <pre class=language-js><!-- HTML_TAG_START --><code class=language-js><span class="token keyword">class</span> <span class="token class-name">CustomException1</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">CustomException2</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">let</span> result<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">unsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//throws CustomException1 & 2</span>
   result <span class="token operator">=</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token function">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">CustomException1</span><span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">CustomException2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"CustomeException2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h=svelte-1kgaj31>But the code here gets really really ugly really really fast. We have to imperatively check which Execution path we should take, opening up the door to many silly bugs.</p> <h2 data-svelte-h=svelte-kzejms id=what-we-want><a href=#what-we-want>What we want</a></h2> <p data-svelte-h=svelte-dvkkc4>Wouldn’t it be really nice if we could declaratively define each execution path an the right thing just happened? Other languages like Rust would make this pretty easy using Errors-As-Values and <code>match</code> statements. Something like this:</p> <pre class=language-rust><!-- HTML_TAG_START --><code class=language-rust><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token function">unsafe_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">CustomExceptions</span><span class="token punctuation">::</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=></span> null<span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">CustomExceptions</span><span class="token punctuation">::</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"CustomeException2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Unexpected Error: {:?}"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h=svelte-xy7f4b>This way we can declaratively define each possible execution branch, drastically reducing the chance of bugs.</p> <h2 data-svelte-h=svelte-9hqu1k id=resultmatcher-a-potential-solution><a href=#resultmatcher-a-potential-solution><code>ResultMatcher</code> a potential solution</a></h2> <p data-svelte-h=svelte-tiiv16>I took a stab at implementing a similar API in JS, and I came up with the <code>ResultMatcher</code> class. You can find the full source code at the bottom of this article. It is used like this:</p> <pre class=language-js><!-- HTML_TAG_START --><code class=language-js><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultMatcher</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>CustomException1<span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>CustomException2<span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"CustomException2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h=svelte-h0ke80>It is fully typesafe making it a breeze to work with.</p> <p data-svelte-h=svelte-aex9p>Let’s take a look at each part:</p> <ul data-svelte-h=svelte-1rlehpz><li><code>const result</code> will be the return value of whatever execution branch is taken. In the snippet above the return type would be <code>string | null</code></li> <li><code>ResultMatcher(unsafe)</code> constructs a matcher instance for the function <code>unsafe</code></li> <li><code>.ok()</code> takes a callback that handles the return value of <code>unsafe</code> if it succeeds. If <code>.ok</code> is not used on the Matcher it will default to the identity function.</li> <li><code>.catch(CustomException1, e => null)</code> Will only run if <code>unsafe</code> throws a <code>CustomException1</code>. It may return a value.</li> <li><code>.run()</code> Actually calls <code>unsafe</code>. If unsafe takes args, you will pass them here (Eg: <code>run("Hello", {option: "a"})</code>). TS will enforce this.</ul> <p data-svelte-h=svelte-12ouq9h>Sometimes you <em>do</em> want to react to all errors that are thrown. Maybe just to log them. For that we have the <code>catchAll</code> method.</p> <ul data-svelte-h=svelte-1fgu1t0><li><code>.catchAll(e => {console.error(e); throw e})</code></ul> <h2 data-svelte-h=svelte-1m2hw0c id=the-snippet><a href=#the-snippet>The Snippet</a></h2> <pre class=language-js><!-- HTML_TAG_START --><code class=language-js><span class="token comment">/**
 * The configuration for a ResultMatcher Strategy.
 *
 * @template Prototype
 * @template ReturnType
 * @typedef {{
 *    prototype: { new (): Prototype;  } | { prototype: Prototype; },
 *    handler: (instance: Prototype) => ReturnType;
 * }} Strategy
 */</span>

<span class="token comment">/**
 * Declaratively define what should happen for all the possible outcomes of a function.
 * This follows an immutable builder pattern, so each method returns a new instance of the ResultMatcher class.
 *
 * @template {(...args: any) => any} UnsafeFunc
 * @template {(result: ReturnType&lt;UnsafeFunc>) => any} [SuccessHandler=((result: ReturnType&lt;UnsafeFunc>) => ReturnType&lt;UnsafeFunc>)]
 * @template {Strategy&lt;any, any>[]} [Strategies=[]]
 * @template {((e: unknown) => any)} [FallbackHandler=(e: unknown) => never]
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ResultMatcher</span> <span class="token punctuation">{</span>
  <span class="token comment">/** @type {UnsafeFunc} */</span>
  #unsafeFunction<span class="token punctuation">;</span>

  <span class="token comment">/** @type {Strategies} */</span>
  #strategies<span class="token punctuation">;</span>

  <span class="token comment">/** @type {SuccessHandler} */</span>
  #successHandler<span class="token punctuation">;</span>

  <span class="token comment">/** @type {FallbackHandler} */</span>
  #fallbackHandler<span class="token punctuation">;</span>

  <span class="token comment">/**
   * @param {UnsafeFunc} func
   * @param {Strategies} strategies
   * @param {SuccessHandler} successHandler
   * @param {FallbackHandler} fallbackHandler
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    func<span class="token punctuation">,</span>
    strategies <span class="token operator">=</span> <span class="token comment">/** @type {any} */</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    successHandler <span class="token operator">=</span> <span class="token comment">/** @type {any} */</span> <span class="token punctuation">(</span>identity<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fallbackHandler <span class="token operator">=</span> <span class="token comment">/** @type {any} */</span> <span class="token punctuation">(</span>raise<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#unsafeFunction <span class="token operator">=</span> func<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#strategies <span class="token operator">=</span> strategies<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#successHandler <span class="token operator">=</span> successHandler<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#fallbackHandler <span class="token operator">=</span> fallbackHandler<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Defines a strategy for a given error type.
   *
   * @template Prototype
   * @template StrategyReturnType
   *
   * @param {{ new (): Prototype;} | { prototype: Prototype; }} prototype - The error type to handle. Thrown things will be compared against this with `instanceof`.
   * @param {(instance: Prototype) => StrategyReturnType} handler - Callback to handle the error.
   * @returns {ResultMatcher&lt;UnsafeFunc, SuccessHandler, [...Strategies, Strategy&lt;Prototype, StrategyReturnType>], FallbackHandler>}
   */</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> registeredStrategy <span class="token operator">=</span> <span class="token punctuation">{</span> prototype<span class="token punctuation">,</span> handler <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultMatcher</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#unsafeFunction<span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>#strategies<span class="token punctuation">,</span> registeredStrategy<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#successHandler<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#fallbackHandler<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * @template {(e:unknown) => any} Handler
   *
   * @param {Handler} handler
   * @returns {ResultMatcher&lt;UnsafeFunc, SuccessHandler, Strategies, Handler>}
   */</span>
  <span class="token function">catchAll</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultMatcher</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#unsafeFunction<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#strategies<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#successHandler<span class="token punctuation">,</span>
      handler<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Handle the happy path
   *
   * @template {(result: ReturnType&lt;UnsafeFunc>) => any} Handler
   * @param {Handler} handler
   * @returns {ResultMatcher&lt;UnsafeFunc, Handler, Strategies, FallbackHandler>}
   */</span>
  <span class="token function">ok</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResultMatcher</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#unsafeFunction<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#strategies<span class="token punctuation">,</span>
      handler<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#fallbackHandler<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Calls the unsafe function with the given parameters and handles any errors that may be thrown
   * according to the registered strategies.
   *
   * @param  {Parameters&lt;UnsafeFunc>} params
   * @returns {ReturnType&lt;SuccessHandler> | ReturnType&lt;Strategies[number]["handler"]> | ReturnType&lt;FallbackHandler>}
   */</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> successResult<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// @ts-ignore</span>
      successResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#unsafeFunction</span><span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> strategy <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#strategies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token comment">/** @type {any} */</span> <span class="token punctuation">(</span>strategy<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> strategy<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#fallbackHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#successHandler</span><span class="token punctuation">(</span>successResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * The identity function
 * @template T
 * @param {T} x
 * @returns {T}
 */</span>
<span class="token keyword">const</span> <span class="token function function-variable">identity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">;</span>

<span class="token comment">/**
 * @template T
 * @param {T} e
 * @returns {never}
 * @throws {T}
 */</span>
<span class="token keyword">const</span> <span class="token function function-variable">raise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre></article> <div class="bg-blue-700 h-3 progress-bar svelte-6gbik3"></div> <script>{__sveltekit_8j58pq={base:new URL(".",location).pathname.slice(0,-1)};const a=document.currentScript.parentElement,b=[null,null,null,{type:"data",data:{title:"Declarative Exception Handling in JavaScript",description:"Handling many different exception types in JavaScript is a pain. In this article we will play around with a declarative approach to exception handling.",published:new Date(16970688e5),author:"Loris Sigrist"},uses:{}}];Promise.all([import("./_app/immutable/entry/start.C11YVUz3.js"),import("./_app/immutable/entry/app.YGDPVTZQ.js")]).then(([e,t])=>{e.start(t,a,{node_ids:[0,2,3,8],data:b,form:null,error:null})}),"serviceWorker"in navigator&&addEventListener("load",function(){navigator.serviceWorker.register("./service-worker.js")})}</script> <!--
			                                                   ,,                  
'7MMF'                         db               .M"""bgd  db                      db            mm    
  MM                                           ,MI    "Y                                        MM    
  MM         ,pW"Wq.'7Mb,od8 '7MM  ,pP"Ybd     'MMb.    '7MM  .P"Ybmmm '7Mb,od8 '7MM  ,pP"Ybd mmMMmm  
  MM        6W'   'Wb MM' "'   MM  8I   '"       'YMMNq.  MM :MI  I8     MM' "'   MM  8I   '"   MM    
  MM      , 8M     M8 MM       MM  'YMMMa.     .     'MM  MM  WmmmP"     MM       MM  'YMMMa.   MM    
  MM     ,M YA.   ,A9 MM       MM  L.   I8     Mb     dM  MM 8M          MM       MM  L.   I8   MM    
.JMMmmmmMMM  'Ybmd9'.JMML.   .JMML.M9mmmP'     P"Ybmmd" .JMML.YMMMMMb  .JMML.   .JMML.M9mmmP'   'Mbmo 
															 6'     dP                                
															 ^bmmmd'                                  
-->
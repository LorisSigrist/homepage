<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width" name=viewport> <link href=./_app/immutable/assets/Metadata.DyfCrczt.css rel=stylesheet> <link href=./_app/immutable/assets/3.CqjOwtjT.css rel=stylesheet> <link href=./_app/immutable/entry/start.KyqW7BtD.js rel=modulepreload> <link href=./_app/immutable/chunks/entry.DAWUFH29.js rel=modulepreload> <link href=./_app/immutable/chunks/scheduler.DwkGEAYb.js rel=modulepreload> <link href=./_app/immutable/chunks/index.CU0sutvA.js rel=modulepreload> <link href=./_app/immutable/entry/app.CSaypSy1.js rel=modulepreload> <link href=./_app/immutable/chunks/preload-helper.CP-VSAQc.js rel=modulepreload> <link href=./_app/immutable/chunks/index.BoYP9eQs.js rel=modulepreload> <link href=./_app/immutable/nodes/0.CMIPQFkk.js rel=modulepreload> <link href=./_app/immutable/nodes/2.BIqr4HlX.js rel=modulepreload> <link href=./_app/immutable/chunks/Metadata.CXt1LOd_.js rel=modulepreload> <link href=./_app/immutable/chunks/stores.pgWVZlPO.js rel=modulepreload> <link href=./_app/immutable/chunks/each.CuygwpM4.js rel=modulepreload> <link href=./_app/immutable/chunks/theme.COyUI6g7.js rel=modulepreload> <link href=./_app/immutable/nodes/3.BMPqw2Om.js rel=modulepreload> <link href=./_app/immutable/nodes/9.DcFycQyw.js rel=modulepreload><title>dts-buddy fixes type declarations</title><!-- HEAD_svelte-1quh51c_START --><script data-svelte-h=svelte-ctkbxh>if("localStorage"in window){let e="dark"===localStorage.getItem("theme"),t="light"===localStorage.getItem("theme"),a=!e&&!t;if(e)document.documentElement.classList.add("dark");else if(t)document.documentElement.classList.remove("dark");else if(a){let e=window.matchMedia("(prefers-color-scheme: dark)");e.matches?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))}}</script><!-- HEAD_svelte-1quh51c_END --><!-- HEAD_svelte-170d11p_START --><meta content="dts-buddy fixes type declarations" name=og:title><meta content="dts-buddy fixes type declarations" name=twitter:title><meta content=website name=og:type> <meta content=/og/dts-buddy%20fixes%20type%20declarations.png name=og:image><link href=/_app/immutable/assets/favicon.BtYv9CGA.png rel=icon><meta content="dts-buddy is a bundler for type-definitions. It helps sidestep the most common issues with type definitions." name=description><meta content="Loris Sigrist" name=author><meta content=2023-07-18T00:00:00.000Z name=date><!-- HEAD_svelte-170d11p_END --> </head> <body data-sveltekit-preload-data=hover> <header class="flex flex-row container justify-between mx-auto print:hidden px-4 py-4"><div class="flex items-center flex-row gap-4" id=header-start data-svelte-h=svelte-1la7e6x><a href=/ class="flex items-center flex-row gap-3"><picture><source srcset="/_app/immutable/assets/avatar.CO8mBa3R.avif, /_app/immutable/assets/avatar.CUQxh67W.avif 2x" type=image/avif><source srcset="/_app/immutable/assets/avatar.B39wt1fA.webp, /_app/immutable/assets/avatar.D9hkS3v8.webp 2x" type=image/webp><source srcset="/_app/immutable/assets/avatar.BJCwippg.png, /_app/immutable/assets/avatar.BQIWiNBc.png 2x" type=image/png><img alt="Loris Sigrist looking very handsome" class="aspect-square rounded-full w-9" height=412 src=/_app/immutable/assets/avatar.BQIWiNBc.png width=412></picture> <span class="font-bold text-md">Loris Sigrist</span></a></div> <div class="flex items-center gap-2 flex-row sm:gap-4" id=header-end><a href=https://dithering.sigrist.dev class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1ilvshw><span class="hidden sm:block">Dither Studio</span></a> <a href=https://zocker.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1tefg7x><span class="hidden sm:block">Zocker</span></a> <a href=https://t18s.sigrist.dev/ class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank data-svelte-h=svelte-1spq4jh><span class="hidden sm:block">t18s</span></a> <a href=https://www.github.com/LorisSigrist class="flex items-center gap-2 rounded-md dark:text-gray-200 hover:bg-gray-100 hover:dark:bg-gray-800 p-1 sm:px-3 text-gray-800" target=_blank><span><svg class="h-4 w-4" fill=none height=1024 viewBox="0 0 1024 1024" width=1024 xmlns=http://www.w3.org/2000/svg><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" clip-rule=evenodd fill=currentColor fill-rule=evenodd transform=scale(64)></path></svg></span> <span class="hidden sm:block" data-svelte-h=svelte-1ob2gl>Github</span></a> <a href=mailto:loris@sigrist.dev class="flex items-center gap-2 rounded-md bg-black dark:bg-white dark:text-black md:px-3 px-1 py-1 text-white"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5><path d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" stroke-linecap=round stroke-linejoin=round></path></svg> <span class="hidden md:block" data-svelte-h=svelte-lz17j7>Contact</span></a> <button class="rounded-md hover:bg-gray-100 hover:dark:bg-gray-800 aspect-square p-2" title="Toggle Theme"> <div class="contents dark:hidden"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=light><path d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" stroke-linecap=round stroke-linejoin=round></path></svg></div> <div class="hidden dark:contents"><svg class="h-4 w-4" fill=none height=100% viewBox="0 0 24 24" width=100% xmlns=http://www.w3.org/2000/svg aria-hidden=true stroke=currentColor stroke-width=1.5 slot=dark><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" stroke-linecap=round stroke-linejoin=round></path></svg></div></button></div></header> <article class="container mx-auto px-4 dark:prose-invert max-w-[70ch] my-8 print:m-0 print:p-0 print:w-100 prose prose-slate"><h1 data-svelte-h=svelte-6meor9 id=dts-buddy-fixes-type-declarations><a href=#dts-buddy-fixes-type-declarations>DTS-Buddy fixes Type-Declarations</a></h1> <p data-svelte-h=svelte-13kfg1b><code>dts-buddy</code> is one of those tools that’s hard to justify without encountering the problem they solve first. Here’s the story of how I ran into it.</p> <p data-svelte-h=svelte-1x748i3>If you don’t care why, you can <a href=#dts-buddy-the-savior>skip past the intro</a></p> <h2 data-svelte-h=svelte-v1ttt0 id=a-horror-story-about-types-in-subpackages><a href=#a-horror-story-about-types-in-subpackages>A horror story about types in subpackages</a></h2> <p data-svelte-h=svelte-15olzmx>I’ve been finding myself copying a lot of code between projects. To make this easier, I’ve been building a package where I keep all my commonly used code. Since it includes code from many domains, using subpackages seemed quite natural. <code>@sigrist.dev/framework/pdf</code> for all my PDF-related code, <code>@sigrist.dev/framework/ui</code> for all my UI-related code, and so on.</p> <p data-svelte-h=svelte-198lpmg>To keep editing convenient, I opted to use JSDoc types, and generate type-declarations from them.</p> <p data-svelte-h=svelte-11jzph8>While doing this, I quickly learned about the pitfalls of using subpackages. Using the TypeScript compiler means I was generating one <code>d.ts</code> file per <code>js</code> file. This caused a problems when importing a subpackage. Whenever I started typing <code>import {</code> the IDE would show me a list of all the types present in the package, including ones that were not meant to be public. This was very irritating.</p> <p data-svelte-h=svelte-1x2j3qn>Another issue I ran into is that <code>go to definition</code> didn’t work. I couldn’t jump to the implementation of a type, because the IDE didn’t know how to map the type-declaration to the actual source code. As the declarations were always colocated with the JS file it wasn’t that bad, but still inconveniet. I often have to glance at the implementation to recall what was going on, since the package isn’t documented well.</p> <h2 data-svelte-h=svelte-y603ka id=dts-buddy-the-savior><a href=#dts-buddy-the-savior>Dts-Buddy; The savior</a></h2> <p data-svelte-h=svelte-b8cecc><code>dts-buddy</code> solves all these things in a very clever way. Instead of colocating each type-declaration with the JS file it belongs to, it generates just one <code>.d.ts</code> file for the entire package. This is then referenced by the <code>types</code> field in your <code>package.json</code>. The file contains module declarations for the public interface of the package and it’s subpackages, using the <code>declare module</code> syntax.</p> <p data-svelte-h=svelte-2h5g6c>Here’s an example output it generated for one of my (private, sorry) packages:</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark lsp twoslash" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#758575DD>// @filename: dist/types.d.ts</span></span>
<span class=line><span style=color:#cb7676>declare</span><span style=color:#cb7676> module</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>@sigrist.dev/framework/pdf</span><span style=color:#c98A7D99>'</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#758575DD>    /**</span></span>
<span class=line><span style=color:#758575DD>    * Adds a QR-ESR Invoice footer to the given PDF.</span></span>
<span class=line><span style=color:#758575DD>    * Assumes the current page has A4 portrait format.</span></span>
<span class=line><span style=color:#758575DD>    *</span></span>
<span class=line><span style=color:#758575DD>    * </span><span style=color:#666>@</span><span style=color:#4d9375>see</span><span style=color:#bd976a> https://www.swiss-qr-invoice.org/validator/?lang=de</span><span style=color:#758575DD> for a validator</span></span>
<span class=line><span style=color:#758575DD>    */</span></span>
<span class=line><span style=color:#4d9375>    export</span><span style=color:#cb7676> function</span><span style=color:#80a665> </span><span style=color:#80a665><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>function</span><span style=color:#80a665> addQrEsrFooter</span><span style=color:#666>(</span><span style=color:#bd976a>pdf</span><span style=color:#666>: </span><span style=color:#cb7676>import</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>jspdf</span><span style=color:#c98A7D99>"</span><span style=color:#666>).</span><span style=color:#5da994>jsPDF</span><span style=color:#666>,</span><span style=color:#bd976a> data</span><span style=color:#666>: </span><span style=color:#5da994>ESRData</span><span style=color:#666>):</span><span style=color:#cb7676> import</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>jspdf</span><span style=color:#c98A7D99>"</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>.</span><span style=color:#5da994>jsPDF</span></code><div class=twoslash-popup-docs>Adds a QR-ESR Invoice footer to the given PDF.
Assumes the current page has A4 portrait format.</div><div class="twoslash-popup-docs twoslash-popup-docs-tags"><span class=twoslash-popup-docs-tag><span class=twoslash-popup-docs-tag-name>@see</span><span class=twoslash-popup-docs-tag-value>https://www.swiss-qr-invoice.org/validator/?lang=de for a validator</span></span></div></span>addQrEsrFooter</span></span><span style=color:#666>(</span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>pdf</span><span style=color:#666>:</span><span style=color:#bd976a> jsPDF</span></code></span>pdf</span></span><span style=color:#666>: </span><span style=color:#cb7676>import</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>jspdf</span><span style=color:#c98A7D99>"</span><span style=color:#666>).</span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> jsPDF</span></code></span>jsPDF</span></span><span style=color:#666>,</span><span style=color:#bd976a> </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>data</span><span style=color:#666>:</span><span style=color:#bd976a> ESRData</span></code></span>data</span></span><span style=color:#666>: </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>type</span><span style=color:#5da994> ESRData</span><span style=color:#666> =</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#bd976a>    amount</span><span style=color:#666>: </span><span style=color:#5da994>number</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#bd976a>    reference</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>ESRData</span></span><span style=color:#666>)</span><span style=color:#666> :</span><span style=color:#cb7676> import</span><span style=color:#666>(</span><span style=color:#c98A7D99>"</span><span style=color:#c98a7d>jspdf</span><span style=color:#c98A7D99>"</span><span style=color:#666>)</span><span style=color:#dbd7CAEE>.</span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#cb7676>class</span><span style=color:#5da994> jsPDF</span></code></span>jsPDF</span></span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#4d9375>    export</span><span style=color:#cb7676> type</span><span style=color:#5da994> </span><span style=color:#5da994><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#cb7676>type</span><span style=color:#5da994> ESRData</span><span style=color:#666> =</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#bd976a>    amount</span><span style=color:#666>: </span><span style=color:#5da994>number</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#bd976a>    reference</span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre></code></span>ESRData</span></span><span style=color:#666> =</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#bd976a>        </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>amount</span><span style=color:#666>:</span><span style=color:#bd976a> number</span></code></span>amount</span></span><span style=color:#666>: </span><span style=color:#5da994>number</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#bd976a>        </span><span style=color:#bd976a><span class=twoslash-hover><span class=twoslash-popup-container><code class=twoslash-popup-code><span style=color:#80a665>reference</span><span style=color:#666>:</span><span style=color:#bd976a> string</span></code></span>reference</span></span><span style=color:#666>: </span><span style=color:#5da994>string</span><span style=color:#666>;</span></span>
<span class=line><span style=color:#758575DD>		//...</span></span>
<span class=line><span style=color:#666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>	// ...</span></span>
<span class=line><span style=color:#666>}</span></span>
<span class=line></span>
<span class=line><span style=color:#cb7676>declare</span><span style=color:#cb7676> module</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>@sigrist.dev/framework/ui</span><span style=color:#c98A7D99>'</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#758575DD>	// ...</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-vsvpk2>Alongside this, it also generates a <code>.map.d.ts</code> file, which maps the public types onto the actual source code. This allows the IDE to “go to definition” and “peek definition” reliably.</p> <h2 data-svelte-h=svelte-1l1k7cz id=how-to-use-it><a href=#how-to-use-it>How to use it</a></h2> <p data-svelte-h=svelte-14wigas>First install it:</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#80a665>pnpm</span><span style=color:#c98a7d> i</span><span style=color:#c99076> -D</span><span style=color:#c98a7d> dts-buddy</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-h4o59e>Then create a <code>build.js</code> file in your project, and use it as your build script:</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#666>{</span></span>
<span class=line><span style=color:#c98A7D99>	"</span><span style=color:#b8a965>scripts</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>		"</span><span style=color:#b8a965>build</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>node build.js</span><span style=color:#c98A7D99>"</span></span>
<span class=line><span style=color:#666>	}</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre><!-- HTML_TAG_END --> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#758575DD>// @filename: build.js</span></span>
<span class=line><span style=color:#4d9375>import</span><span style=color:#666> {</span><span style=color:#bd976a> createBundle</span><span style=color:#666> }</span><span style=color:#4d9375> from</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>dts-buddy</span><span style=color:#c98A7D99>'</span><span style=color:#666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>//Generate a bundle of all type-declarations</span></span>
<span class=line><span style=color:#4d9375>await</span><span style=color:#80a665> createBundle</span><span style=color:#666>({</span></span>
<span class=line><span style=color:#b8a965>	project</span><span style=color:#666>:</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>tsconfig.json</span><span style=color:#c98A7D99>'</span><span style=color:#666>,</span><span style=color:#758575DD> //Your tsconfig.json</span></span>
<span class=line></span>
<span class=line><span style=color:#758575DD>	//Map subpackages to their entrypoints</span></span>
<span class=line><span style=color:#b8a965>	modules</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>		'</span><span style=color:#c98a7d>@sigrist.dev/framework/pdf</span><span style=color:#c98A7D99>'</span><span style=color:#666>:</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>src/pdf/index.js</span><span style=color:#c98A7D99>'</span><span style=color:#666>,</span></span>
<span class=line><span style=color:#c98A7D99>		'</span><span style=color:#c98a7d>@sigrist.dev/framework/ui</span><span style=color:#c98A7D99>'</span><span style=color:#666>:</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>src/ui/index.js</span><span style=color:#c98A7D99>'</span></span>
<span class=line><span style=color:#666>	},</span></span>
<span class=line></span>
<span class=line><span style=color:#b8a965>	include</span><span style=color:#666>:</span><span style=color:#666> [</span><span style=color:#c98A7D99>'</span><span style=color:#c98a7d>src</span><span style=color:#c98A7D99>'</span><span style=color:#666>],</span></span>
<span class=line></span>
<span class=line><span style=color:#b8a965>	output</span><span style=color:#666>:</span><span style=color:#c98A7D99> '</span><span style=color:#c98a7d>types/index.d.ts</span><span style=color:#c98A7D99>'</span><span style=color:#758575DD> //The resulting type-declaration file</span></span>
<span class=line><span style=color:#666>});</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-11fftnk>The only thing left to do is to tell the module-resolution to actually use the generated file. So, in your <code>package.json</code>, add a <code>types</code> field, and also register it in each <code>exports</code> field.</p> <!-- HTML_TAG_START --><pre class="shiki vitesse-dark" style=background-color:#121212;color:#dbd7caee tabindex=0><code><span class=line><span style=color:#666>{</span></span>
<span class=line><span style=color:#c98A7D99>	"</span><span style=color:#b8a965>types</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>types/index.d.ts</span><span style=color:#c98A7D99>"</span><span style=color:#666>,</span><span style=color:#758575DD> //here</span></span>
<span class=line><span style=color:#c98A7D99>	"</span><span style=color:#b8a965>exports</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>		"</span><span style=color:#b8a965>.</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>types</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>types/index.d.ts</span><span style=color:#c98A7D99>"</span><span style=color:#666>,</span><span style=color:#758575DD> //here</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>import</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>./src/index.js</span><span style=color:#c98A7D99>"</span></span>
<span class=line><span style=color:#666>		},</span></span>
<span class=line><span style=color:#c98A7D99>		"</span><span style=color:#b8a965>./pdf</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>types</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>types/index.d.ts</span><span style=color:#c98A7D99>"</span><span style=color:#666>,</span><span style=color:#758575DD> //here</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>import</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>./src/pdf/index.js</span><span style=color:#c98A7D99>"</span></span>
<span class=line><span style=color:#666>		},</span></span>
<span class=line><span style=color:#c98A7D99>		"</span><span style=color:#b8a965>./ui</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#666> {</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>types</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>types/index.d.ts</span><span style=color:#c98A7D99>"</span><span style=color:#666>,</span><span style=color:#758575DD> //here</span></span>
<span class=line><span style=color:#c98A7D99>			"</span><span style=color:#b8a965>import</span><span style=color:#c98A7D99>"</span><span style=color:#666>:</span><span style=color:#c98A7D99> "</span><span style=color:#c98a7d>./src/ui/index.js</span><span style=color:#c98A7D99>"</span></span>
<span class=line><span style=color:#666>		}</span></span>
<span class=line><span style=color:#666>	}</span></span>
<span class=line><span style=color:#666>}</span></span></code></pre><!-- HTML_TAG_END --> <p data-svelte-h=svelte-4gj9lj>That’s it! Now you can run <code>npm run build</code> and it’ll generate a single type-declaration file (+map) for your entire package.</p> <h2 data-svelte-h=svelte-13u71ln id=should-you-use-it><a href=#should-you-use-it>Should you use it?</a></h2> <p data-svelte-h=svelte-p7dlfn><code>dts-buddy</code> is a tool that solves the subpackage-problem very very well. Outside of that, the regular TypeScript compiler is good enough. It’s going to be more familiar to most developers and is maintained more actively. But when you do need <code>dts-buddy</code>, it’s a lifesaver.</p> <p data-svelte-h=svelte-yzmwae>I for one have really enjoyed it and am very likely to choose it again.</article> <div class="bg-blue-700 h-3 progress-bar svelte-co5fg3"></div> <script>{__sveltekit_19qx780={base:new URL(".",location).pathname.slice(0,-1)};let i=document.currentScript.parentElement,r=[null,null,null,{type:"data",data:{title:"dts-buddy fixes type declarations",description:"dts-buddy is a bundler for type-definitions. It helps sidestep the most common issues with type definitions.",published:new Date(16896384e5),author:"Loris Sigrist",draft:!1},uses:{}}];Promise.all([import("./_app/immutable/entry/start.KyqW7BtD.js"),import("./_app/immutable/entry/app.CSaypSy1.js")]).then(([e,t])=>{e.start(t,i,{node_ids:[0,2,3,9],data:r,form:null,error:null})}),"serviceWorker"in navigator&&addEventListener("load",function(){navigator.serviceWorker.register("./service-worker.js")})}</script> 